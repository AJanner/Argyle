<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="favicon.ico" rel="icon" type="image/x-icon"/>
<title>ğŸ’­MindsEyeğŸ’¬~Ideas</title>
<style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: black;
      font-family: sans-serif;
    }
    #toolbar {
      position: fixed;
      top: 0;
      width: 100%;
      background: #111;
      opacity: 0.7;
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      z-index: 1000;
      transition: opacity 0.5s ease;
    }
#toolbar button {
  background-color: rgba(0, 0, 0, 0.7); /* black with opacity */
  color: gold; /* gold text */
  border: 2px solid darkgreen; /* dark green border */
  font-family: 'Monaco', serif;
  border-radius: 6px;
  padding: 6px 10px;
  margin-right: 6px;
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.2s ease;
}

#toolbar button:hover {
  background-color: rgba(0, 0, 0, 0.9); /* darker on hover */
  transform: scale(1.05);
}
    #canvas {
      display: block;
      z-index: -1;
    }
    .panel {
      position: fixed;
      top: 130px;
      left: 15px;
      transform: none;
      width: 300px;
      min-width: 250px;
      max-width: 1000px;
      background: rgba(34, 34, 34, 0.90);
      color: white;
      padding: 20px;
      border-radius: 16px;
      z-index: 999;
      display: none;
      resize: both;
      overflow: auto;
      transition: opacity 0.5s ease;
    }
    
    .resize-handle {
      position: absolute;
      bottom: 5px;
      right: 5px;
      width: 20px;
      height: 20px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 3px;
      cursor: se-resize;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    
    .dice-overlay {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: gold;
      font-size: 120px;
      font-weight: bold;
      padding: 40px;
      border-radius: 20px;
      border: 3px solid darkgreen;
      z-index: 2000;
      display: none;
      animation: diceFadeIn 0.3s ease-in;
    }
    
    .music-panel {
      position: fixed;
      top: 130px;
      right: 15px;
      width: 300px;
      background: rgba(34, 34, 34, 0.90);
      color: white;
      padding: 20px;
      border-radius: 16px;
      z-index: 999;
      display: none;
      max-height: 70vh;
      overflow-y: auto;
    }
    
    .music-panel h3 {
      color: gold;
      margin-top: 0;
      text-align: center;
    }
    
    .music-item {
      background: rgba(0, 0, 0, 0.6);
      color: white;
      border: 1px solid darkgreen;
      padding: 8px 12px;
      margin: 5px 0;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    
    .music-item:hover {
      background: rgba(0, 0, 0, 0.8);
      color: gold;
    }
    
    .music-item.playing {
      background: rgba(0, 100, 0, 0.6);
      color: gold;
      border-color: gold;
    }
    
    @keyframes diceFadeIn {
      from { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
      to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }
    .panel input, .panel textarea {
      width: 100%;
      margin: 5px 0;
      background: #333;
      border: none;
      color: white;
      padding: 5px;
    }
    .panel button {
     margin-right: 10px;
     padding: 6px 12px;
     background-color: rgba(0, 0, 0, 0.7); /* black with opacity */
     color: gold; /* gold text */
     border: 2px solid darkgreen; /* dark green border */
     font-family: 'Monaco', serif; /* more elegant serif font */
     border-radius: 8px; /* optional: rounder corners */
     cursor: pointer;
     transition: background-color 0.3s ease, transform 0.2s ease;
}
    .panel button:hover {
     background-color: rgba(0, 0, 0, 0.9); /* darker on hover */
     transform: scale(1.05); /* subtle zoom effect */
}

    #bgVideo {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    z-index: -2;
    pointer-events: none;
    display: none; /* default hidden, shown when video is loaded */
    background: black;
}
  
#bubblePanel {
  resize: both;
  overflow: auto;
  min-width: 200px;
  min-height: 150px;
}

/* S25 Theme Styles */
#s25Player {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1001;
  display: none;
  background: rgba(0, 0, 0, 0.9);
  transition: all 0.5s ease;
}

#s25Player.fullscreen {
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

#s25Player.centered {
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 80%;
  height: 60%;
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
}

#s25Player iframe {
  width: 100%;
  height: 100%;
  border: none;
  border-radius: inherit;
}

#s25Controls {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1002;
  display: none;
  background: rgba(0, 0, 0, 0.8);
  padding: 15px;
  border-radius: 10px;
  border: 2px solid #4CAF50;
  transition: opacity 0.5s ease;
  opacity: 1;
}

#s25Controls button {
  background: linear-gradient(45deg, #4CAF50, #45a049);
  border: none;
  color: white;
  padding: 8px 16px;
  margin: 5px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
}

#s25Controls button:hover {
  transform: scale(1.05);
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

#s25Playlist {
  position: fixed;
  top: 20px;
  left: 20px;
  width: 300px;
  max-height: 400px;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 15px;
  border-radius: 10px;
  border: 2px solid #4CAF50;
  z-index: 1002;
  display: none;
  overflow-y: auto;
  transition: opacity 0.5s ease;
  opacity: 1;
}

#s25Playlist h3 {
  color: #4CAF50;
  margin-top: 0;
  text-align: center;
}

.playlist-item {
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: 1px solid #4CAF50;
  padding: 8px 12px;
  margin: 5px 0;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.playlist-item:hover {
  background: rgba(255, 255, 255, 0.2);
  color: #4CAF50;
}

.playlist-item.playing {
  background: rgba(76, 175, 80, 0.6);
  color: white;
  border-color: #4CAF50;
}
</style>
<style>
#playbackToolbar {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
  color: white;
  display: flex;
  justify-content: center; 
  align-items: center;
  gap: 15px;
  padding: 15px;
  z-index: 1000;
  display: none;
  flex-wrap: wrap;
  border-top: 2px solid #333;
  box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
}

#playbackToolbar .record-btn,
#playbackToolbar .play-btn,
#playbackToolbar .snapshot-btn {
  background: linear-gradient(45deg, #4CAF50, #45a049);
  border: none;
  color: white;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
}

#playbackToolbar .record-btn:hover,
#playbackToolbar .play-btn:hover,
#playbackToolbar .snapshot-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

#playbackToolbar .end-btn {
  background: linear-gradient(45deg, #f44336, #da190b);
}

#playbackToolbar .play-btn {
  background: linear-gradient(45deg, #2196F3, #1976D2);
}

#playbackToolbar .snapshot-btn {
  background: linear-gradient(45deg, #FF9800, #F57C00);
}

#playbackToolbar .timeline-control,
#playbackToolbar .duration-control {
  display: flex;
  align-items: center;
  gap: 10px;
}

#playbackToolbar .timeline-control span,
#playbackToolbar .duration-control span {
  color: #ccc;
  font-size: 12px;
}

#playbackToolbar #playbackSlider {
  width: 250px;
  height: 6px;
  border-radius: 3px;
  background: #333;
  outline: none;
}

#playbackToolbar #playbackDuration {
  background: #333;
  color: white;
  border: 1px solid #555;
  padding: 6px;
  border-radius: 4px;
  outline: none;
}

/* Media Toolbar Styles */
#mediaToolbar {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 15px;
  padding: 15px;
  z-index: 1000;
  display: none;
  border-top: 2px solid #333;
  box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
  flex-wrap: wrap;
  overflow-x: auto;
}

#mediaToolbar label {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 12px;
  color: #ccc;
}

#mediaToolbar input[type="file"],
#mediaToolbar input[type="text"] {
  background: #333;
  color: white;
  border: 1px solid #555;
  padding: 6px;
  border-radius: 4px;
  outline: none;
}

#mediaToolbar button {
  background: linear-gradient(45deg, #2196F3, #1976D2);
  border: none;
  color: white;
  padding: 6px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
}

#mediaToolbar button:hover {
  transform: scale(1.05);
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

#mediaToolbar .media-separator {
  width: 1px;
  height: 30px;
  background: #555;
  margin: 0 10px;
}

#mediaToolbar .record-btn,
#mediaToolbar .play-btn,
#mediaToolbar .snapshot-btn {
  background: linear-gradient(45deg, #4CAF50, #45a049);
  border: none;
  color: white;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
}

#mediaToolbar .record-btn:hover,
#mediaToolbar .play-btn:hover,
#mediaToolbar .snapshot-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

#mediaToolbar .end-btn {
  background: linear-gradient(45deg, #f44336, #da190b);
}

#mediaToolbar .play-btn {
  background: linear-gradient(45deg, #2196F3, #1976D2);
}

#mediaToolbar .snapshot-btn {
  background: linear-gradient(45deg, #FF9800, #F57C00);
}

#mediaToolbar .timeline-control,
#mediaToolbar .duration-control {
  display: flex;
  align-items: center;
  gap: 10px;
}

#mediaToolbar .timeline-control span,
#mediaToolbar .duration-control span {
  color: #ccc;
  font-size: 12px;
}

#mediaToolbar #mediaPlaybackSlider {
  width: 200px;
  height: 6px;
  border-radius: 3px;
  background: #333;
  outline: none;
}

#mediaToolbar #mediaPlaybackDuration {
  background: #333;
  color: white;
  border: 1px solid #555;
  padding: 6px;
  border-radius: 4px;
  outline: none;
}


#themeSelector {
  background-color: rgba(0, 0, 0, 0.7);
  color: gold;
  border: 2px solid darkgreen;
  font-family: 'Monaco', serif;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  appearance: none; /* Hide default OS styles */
}

#themeSelector:hover {
  background-color: rgba(0, 0, 0, 0.9);
}
input[type="range"] {
  -webkit-appearance: none;
  width: 150px;
  height: 8px;
  background: rgba(0, 0, 0, 0.6); /* black with opacity */
  border: 2px solid darkgreen;
  border-radius: 5px;
  outline: none;
  margin-left: 10px;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: gold;
  cursor: pointer;
  border: 2px solid darkgreen;
  box-shadow: 0 0 4px gold;
}

input[type="range"]::-moz-range-thumb {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: gold;
  cursor: pointer;
  border: 2px solid darkgreen;
  box-shadow: 0 0 4px gold;
}
/* File inputs (Image + Video File) */
input[type="file"] {
  background-color: rgba(0, 0, 0, 0.6);
  color: gold;
  border: 2px solid darkgreen;
  font-family: 'Monaco', serif;
  padding: 6px;
  border-radius: 6px;
  cursor: pointer;
}

/* Text input (YouTube Link) */
input[type="text"] {
  background-color: rgba(0, 0, 0, 0.6);
  color: gold;
  border: 2px solid darkgreen;
  font-family: 'Monaco', serif;
  padding: 6px;
  border-radius: 6px;
  width: 120px; /* optional override for placeholder readability */
}

/* Button next to YouTube input */
#toolbar button, #playbackToolbar button {
  background-color: rgba(0, 0, 0, 0.7);
  color: gold;
  border: 2px solid darkgreen;
  font-family: 'Monaco', serif;
  border-radius: 6px;
  padding: 6px 10px;
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.2s ease;
}
#toolbar button:hover, #playbackToolbar button:hover {
  background-color: rgba(0, 0, 0, 0.9);
  transform: scale(1.05);
}
</style>
<style>
  .bubble {
    position: absolute;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    text-align: center;
    padding: 5px;
    overflow: hidden;
    transition: all 0.3s ease;
  }
  .bubble img {
    position: absolute;
    width: 90%;
    height: 90%;
    border-radius: 50%;
    object-fit: cover;
    z-index: 0;
  }
  .bubble span {
    position: relative;
    z-index: 1;
  }
  .glow {
    box-shadow: 0 0 20px 5px white;
  }
  .flash {
    animation: flash 0.5s infinite alternate;
  }
  @keyframes flash {
    from { opacity: 1; }
    to { opacity: 0.5; }
  }
  .animate-colors {
    animation: colorCycle 5s infinite linear;
  }
  @keyframes colorCycle {
    0% { background-color: red; }
    25% { background-color: yellow; }
    50% { background-color: green; }
    75% { background-color: blue; }
    100% { background-color: red; }
  }
  .transparent {
    background-color: rgba(255, 255, 255, 0.1);
  }
</style>
</head>
<body>
<script>
function togglePlaybackToolbar() {
  const bar = document.getElementById("playbackToolbar");
  if (bar) {
    bar.style.display = (bar.style.display === "none" || bar.style.display === "") ? "flex" : "none";
  }
}
</script>
<div id="toolbar"><button onclick="captureCanvasOnly()" title="Snapshot">ğŸ“·</button><button onclick="rollDice()" title="Random">ğŸ²</button><span id="diceResult" style="color: gold; margin: 0 10px; font-weight: bold;"></span><button onclick="location.reload()" title="Reset">â“‡</button><button onclick="toggleMusicPanel()" title="Music Panel">ğŸ¶</button><button onclick="toggleMediaToolbar()" title="Media Toolbar">ğŸ›ï¸</button><button onclick="rotateBackground()" style="margin-left:10px;" title="Rotate Background">ğŸ”„</button><button onclick="cycleBackground()" style="margin-left:10px;" title="Change Background">â¯ï¸</button><button onclick="speedMultiplier = 0;" style="margin-left:10px;" title="Pause">â¸ï¸</button>
<div><strong>ğŸ¤”ğŸ’­MindsEyeğŸ’¬~Events-Ideas-Incidents-LoggerğŸ˜JSON-Exporter-V3-LegallyGroundedâ˜•ï¸</strong>
<br>
â¡ï¸ <select id="themeSelector" onchange="switchTheme(this.value)" style="background: rgba(0, 0, 0, 0.6); color: gold; border: 2px solid darkgreen; font-family: 'Monaco', serif; padding: 6px; border-radius: 6px;" title="Select Use">
<option value="default">Start ğŸ˜€</option>
<option value="argyle">Argyle â™»ï¸</option>
<option value="cqc">Games ğŸ®</option>
<option value="blank">Blank ğŸ˜¶</option>
<option value="meme">Memes ğŸ™„</option>
<option value="foods">Food ğŸ˜‹</option>
<option value="s25">ğŸŸï¸S25âš½ï¸</option>
<option value="sleep">ğŸ¥± ğŸ˜´</option>
<option value="credits"> ğŸ’š</option>
</select><label style="margin-left: 1px;" title="Motion"> â¬…ï¸ğŸš¦:âš¡ï¸<input max="3" min="0.0" onchange="speedMultiplier = parseFloat(this.value)" step="0.1" type="range" value="1"/>
</label></div>
<button onclick="saveIdeas()" title="Save .json File">ğŸ’¾Save.json</button>
<input accept=".json" id="fileLoader" style="display:none" type="file"/>
<button onclick="document.getElementById('fileLoader').click()" title="Load .json File">ğŸ†™ Load.json</button>
<button onclick="deleteAllIdeas()" style="margin-left:0px;" title="Blank Canvas">ğŸš®ClearğŸ’­IdeasğŸ—‘ï¸</button><button onclick="toggleS25Player()" style="margin-left:10px;" title="Toggle S25 Player">ğŸŸï¸S25âš½ï¸</button>
</div>

<!-- New Media Toolbar -->
<div id="mediaToolbar">
  <label>ğŸ–¼ï¸ Background:
        <input accept="image/*" id="bgLoader" type="file"/>
</label>
  <label>ğŸ“€ Video:
        <input accept="video/*" id="videoLoader" type="file"/>
</label>
  <label>ğŸ¥ YouTube:
        <input id="youtubeLink" placeholder="Paste Video URL" type="text"/>
<button onclick="loadYouTubeVideo()">Load</button>
</label>
  <div class="media-separator"></div>
  <button onclick="recordState('start')" class="record-btn start-btn" title="Mark In Point">ğŸ¬ In</button>
  <button onclick="recordState('end')" class="record-btn end-btn" title="Mark Out Point">ğŸ Out</button>
  <button onclick="startPlayback()" class="play-btn" title="Play In to Out">â–¶ï¸ Play</button>
  <div class="timeline-control">
    <span>Timeline:</span>
    <input id="mediaPlaybackSlider" max="1" min="0" step="0.01" type="range" value="0"/>
  </div>
  <div class="duration-control">
    <span>Duration:</span>
    <select id="mediaPlaybackDuration">
      <option value="5000">5s</option>
      <option selected="" value="10000">10s</option>
      <option value="15000">15s</option>
      <option value="20000">20s</option>
      <option value="30000">30s</option>
    </select>
  </div>
  <button onclick="captureCanvas()" class="snapshot-btn" title="Snapshot">ğŸ“· Snapshot</button>
</div>
<video autoplay="" id="bgVideo" loop="" muted="" playsinline="" style="position:fixed; top:0; left:0; width:100vw; height:100vh; object-fit:cover; z-index:-2; display:none; pointer-events: none;"></video>
<iframe allow="autoplay" allowfullscreen="" frameborder="0" id="ytFrame" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:-3; display:none;"></iframe>

<!-- S25 Theme Player -->
<div id="s25Player" onmouseenter="showS25Controls(); showS25Playlist()">
  <iframe id="s25Iframe" allow="autoplay" allowfullscreen="" frameborder="0"></iframe>
</div>

<!-- S25 Controls -->
<div id="s25Controls">
  <button onclick="s25Play()" title="Play">â–¶ï¸ Play</button>
  <button onclick="s25Pause()" title="Pause">â¸ï¸ Pause</button>
  <button onclick="s25Next()" title="Next">â­ï¸ Next</button>
  <button onclick="s25Prev()" title="Previous">â®ï¸ Prev</button>
  <button onclick="s25TogglePlaylist()" title="Toggle Playlist">YouTubeğŸ“‹</button>
  <button onclick="s25ToggleFullscreen()" title="Toggle Fullscreen">ğŸ–¥ï¸Fullscreen</button>
  <button onclick="s25Close()" title="Close">âŒ Close</button>
</div>

<!-- S25 Playlist Panel -->
<div id="s25Playlist">
  <h3>ğŸ’š YouTube Playlist â™»ï¸</h3>
  <div id="s25PlaylistItems">
    <!-- Playlist items will be loaded here -->
  </div>
</div>
<div class="dice-overlay" id="diceOverlay"></div>
<canvas id="canvas"></canvas>
<div class="music-panel" id="musicPanel">
  <h3>ğŸµ Music Player</h3>
  <div id="musicList">
    <!-- Music items will be loaded here -->
  </div>
  <button onclick="stopMusic()" style="background: linear-gradient(45deg, #f44336, #da190b); border: none; color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 10px; width: 100%;">ğŸ”‡ Stop Music</button>
</div>
<div class="panel" id="panel">
<input id="title" placeholder="Title"/>
<textarea id="description" placeholder="Description" rows="5"></textarea>
<div class="resize-handle">â¤¡</div>
<div style="margin-top: 1px;">
<input accept="image/*" id="uploadImage" type="file"/>
</div>
<label style="margin-left: 10px;">â¬†ï¸ Upload PNG | â¬‡ï¸ Change ğŸ’­ Size
<input id="sizeSlider" title="Bubble Size" max="200" min="10" oninput="selectedIdea.radius = parseInt(this.value)" type="range" value="75"/>
</label><br>
<label style="margin-left: 10px;">â¬‡ï¸ Text Size<br>
<input id="fontSizeSlider" title="Text Size" max="48" min="8" oninput="selectedIdea.fontSize = parseInt(this.value)" type="range" value="14"/>
</label>
<input id="rotationSlider" title="Rotate Bubble" max="360" min="0" oninput="selectedIdea.rotation = parseInt(this.value)" type="range" value="0"/>
</label>
<div style="margin-bottom: 10px;">
<label style="margin-left: 10px;">â¬†ï¸ Rotation | â¬‡ï¸ Select Image â™»ï¸
    <select id="imageSelector" style="background-color: rgba(0, 0, 0, 0.6); color: gold; border: 2px solid darkgreen; font-family: 'Monaco', serif; padding: 6px; border-radius: 6px; width: 100%; margin-top: 5px;">
<option value="">None</option>
<option value="images/a1.png">a1.png</option>
<option value="images/a2.png">a2.png</option>
<option value="images/a3.png">a3.png</option>
<option value="images/a4.png">a4.png</option>
<option value="images/a5.png">a5.png</option>
<option value="images/a6.png">a6.png</option>
<option value="images/a7.png">a7.png</option>
<option value="images/a8.png">a8.png</option>
<option value="images/a9.png">a9.png</option>
<option value="images/a10.png">a10.png</option>
<option value="images/a11.png">a11.png</option>
<option value="images/a12.png">a12.png</option>
<option value="images/a13.png">a13.png</option>
<option value="images/a14.png">a14.png</option>
<option value="images/a15.png">a15.png</option>
<option value="images/a16.png">a16.png</option>
<option value="images/a17.png">a17.png</option>
<option value="images/a18.png">a18.png</option>
<option value="images/a19.png">a19.png</option>
<option value="images/a20.png">a20.png</option>
<option value="images/a21.png">a21.png</option>
<option value="images/a22.png">a22.png</option>
<option value="images/a23.png">a23.png</option>
<option value="images/a24.png">a24.png</option>
<option value="images/a25.png">a25.png</option>
<option value="images/a26.png">a26.png</option>
<option value="images/a27.png">a27.png</option>
<option value="images/a28.png">a28.png</option>
<option value="images/a29.png">a29.png</option>
<option value="None">---â™»ï¸ArchiveğŸ’š---</option>
  <option value="images/l1.png">l1.png</option>
  <option value="images/l2.png">l2.png</option>
  <option value="images/l3.png">l3.png</option>
  <option value="images/l4.png">l4.png</option>
  <option value="images/l5.png">l5.png</option>
  <option value="images/l6.png">l6.png</option>
  <option value="images/l7.png">l7.png</option>
  <option value="images/l8.png">l8.png</option>
  <option value="images/l9.png">l9.png</option>
  <option value="images/l10.png">l10.png</option>
  <option value="images/l11.png">l11.png</option>
  <option value="images/l12.png">l12.png</option>
  <option value="images/l13.png">l13.png</option>
  <option value="images/l14.png">l14.png</option>
  <option value="images/l15.png">l15.png</option>
  <option value="images/l16.png">l16.png</option>
  <option value="images/l17.png">l17.png</option>
  <option value="images/l18.png">l18.png</option>
  <option value="images/l19.png">l19.png</option>
  <option value="images/l20.png">l20.png</option>
  <option value="images/l21.png">l21.png</option>
  <option value="images/l22.png">l22.png</option>
  <option value="images/l23.png">l23.png</option>
  <option value="images/l24.png">l24.png</option>
  <option value="images/l25.png">l25.png</option>
  <option value="images/l26.png">l26.png</option>
  <option value="images/l27.png">l27.png</option>
  <option value="images/l28.png">l28.png</option>
  <option value="images/l29.png">l29.png</option>
  <option value="images/l30.png">l30.png</option>
  <option value="images/l31.png">l31.png</option>
  <option value="images/l32.png">l32.png</option>
  <option value="images/l33.png">l33.png</option>
  <option value="images/l34.png">l34.png</option>
  <option value="images/l35.png">l35.png</option>
  <option value="images/l36.png">l36.png</option>
  <option value="images/l37.png">l37.png</option>
  <option value="images/l38.png">l38.png</option>
  <option value="images/l39.png">l39.png</option>
  <option value="images/l40.png">l40.png</option>
</select>
</label>
<div style="margin-bottom: 10px;">
<button onclick="toggleGlow()" title="Toggle Glow">Glow</button>
<button onclick="changeGlowColor()" title="Change Glow Color">Colour</button>
<button onclick="toggleFlash()" title="Toggle Flash">Flash</button>
<button onclick="toggleAnimateColors()" title="Toggle Animate Colors">AllğŸ¨</button>
<button onclick="toggleTransparent()" title="Toggle Transparent">Opaque</button>
<button onclick="toggleFixed()" title="Toggle Fixed Mode">SolidğŸ—¿</button>
<button onclick="toggleStatic()" title="Toggle Static Mode">StaticğŸ§½</button>
<button onclick="togglePanelSide()" title="Toggle Panel Side">â†”ï¸</button>
</div>
<div style="margin-top: 10px;">
<button onclick="savePanel()" title="Save">SaveğŸ’¾</button>
<button onclick="changeColor()" title="Bubble Colour">ğŸ’­ï¸Colour</button>
<button onclick="changeTextColor()" title="Text Colour">ğŸ’¬Colour</button>
<button onclick="cycleFont()" title="Cycle Fonts">Font</button>
<button onclick="clearUploadedImage()" title="Clear IMG">ğŸ—‘ï¸Image</button>
<button onclick="testImageUpload()" title="AI">ğŸ§ªTest</button>
<button onclick="testEffects()" title="Test Effects">ğŸ­ Effects</button>
<button onclick="deleteIdea()" title="Delete Bubble">DeleteğŸ’­ï¸</button>
<button onclick="closePanel()" title="Close">CloseğŸ’­ï¸</button>
</div>
</div>

<script>
    let movementDelayActive = true;
    let backgroundRotation = 0; // 0, 90, 180, 270
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const panel = document.getElementById("panel");
    let width, height;
    function resize() {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resize);
    resize();

    movementDelayActive = true; // Start with movement disabled
    setTimeout(() => {
    movementDelayActive = false; // Enable after 10 seconds
 }, 10000); // 10 seconds

const border = 10;
    
    let speedMultiplier = 1;
    let ideas = [];
    let selectedIdea = null;
    let backgroundImage = null;
    const defaultBackground = new Image();
      defaultBackground.src = "images/default1.png";
defaultBackground.onload = () => {
  backgroundImage = defaultBackground;
};
   
    const fonts = [
  "Arial",
  "Monaco",
  "Verdana",
  "Tahoma",
  "Trebuchet MS",
  "Comic Sans MS",
  "Impact",
  "Franklin Gothic Medium",
  "Century Gothic",
  "Calibri",
  "Cambria",
  "Constantia",
  "Corbel",
  "Arial Black",
  "System-ui",         // Default OS font
  "Sans-serif",
  "Times New Roman",
  "Georgia",
  "Garamond",
  "Courier New",
  "Lucida Sans Unicode",
  "Palatino Linotype",
  "Serif",
  "Monospace"
];
    let fontIndex = 0;

    function randomColor() {
      return `hsl(${Math.random() * 360}, 100%, 70%)`;
    }
    function randomTextColor() {
  const hue = Math.floor(Math.random() * 360);         // full color wheel
  const saturation = 100;                              // max saturation for vibrancy
  const lightness = 50 + Math.random() * 10;           // keep brightness between 50â€“60%
  return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
}
    function addIdea(x, y, title = "", description = "", color = randomColor(), textColor = "white", radius = 80) {
      const maxSpeed = 3;
      // Ensure we always have a proper random color
      const bubbleColor = color || randomColor();
      ideas.push({ 
        title, 
        description, 
        x, 
        y, 
        vx: (Math.random() * 2 - 1) * maxSpeed, 
        vy: (Math.random() * 2 - 1) * maxSpeed, 
        color: bubbleColor, 
        textColor, 
        radius, 
        font: fonts[0],
        // Initialize effects as false
        glow: false,
        flash: false,
        animateColors: false,
        transparent: false,
        // Initialize glow color as null (will use bubble color by default)
        glowColor: null,
        // Initialize fixed as false (bubble will move normally)
        fixed: false,
        // Initialize static as false (bubble will move normally)
        static: false
      });
      console.log("ğŸ†• New bubble created with color:", bubbleColor);
    }

    canvas.addEventListener("click", (e) => {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      let clicked = false;
      for (let idea of ideas) {
        const dx = x - idea.x;
        const dy = y - idea.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < idea.radius) {
          selectedIdea = idea;
          showPanel();
          clicked = true;
          break;
        }
      }
      if (!clicked) addIdea(x, y);
    });

    function showPanel() {
  document.getElementById("title").value = selectedIdea.title;
  document.getElementById("description").value = selectedIdea.description;
  document.getElementById("sizeSlider").value = selectedIdea.radius || 80;
  document.getElementById("fontSizeSlider").value = selectedIdea.fontSize || 14;
  document.getElementById("rotationSlider").value = selectedIdea.rotation || 0;
  
  // Update image selector to show current image
  if (selectedIdea.image) {
    // Check if it's a data URL (uploaded image)
    if (selectedIdea.image.startsWith('data:')) {
      document.getElementById("imageSelector").value = "";
      // Show indicator that custom image is uploaded
      const uploadInput = document.getElementById('uploadImage');
      uploadInput.style.border = '2px solid gold';
      uploadInput.title = "Custom image uploaded";
    } else {
      // It's a file from the dropdown
      document.getElementById("imageSelector").value = selectedIdea.image;
      document.getElementById('uploadImage').style.border = '';
      document.getElementById('uploadImage').title = "Upload custom image";
    }
  } else {
    document.getElementById("imageSelector").value = "";
    document.getElementById('uploadImage').style.border = '';
    document.getElementById('uploadImage').title = "Upload custom image";
  }
  
  // Note: Effect buttons don't need to be updated since they toggle on/off
  
  panel.style.display = "block";
  
  // Start panel fade-out timer
  resetPanelFade();
}
    function savePanel() {
      selectedIdea.title = document.getElementById("title").value;
      selectedIdea.description = document.getElementById("description").value;
      panel.style.display = "none";
    }
    function deleteIdea() {
      if (selectedIdea) {
        ideas = ideas.filter(idea => idea !== selectedIdea);
        selectedIdea = null;
        panel.style.display = "none";
      }
    }
    function closePanel() { 
  panel.style.display = "none"; 
  // Clear panel fade timeout
  if (panelFadeTimeout) {
    clearTimeout(panelFadeTimeout);
    panelFadeTimeout = null;
  }
}
function changeColor() { 
  selectedIdea.color = randomColor(); 
  console.log("ğŸ¨ Color changed to:", selectedIdea.color);
}
function changeTextColor() { selectedIdea.textColor = randomTextColor(); }
function cycleFont() {
  fontIndex = (fontIndex + 1) % fonts.length;
  selectedIdea.font = fonts[fontIndex];
}
function clearUploadedImage() {
  if (selectedIdea) {
    selectedIdea.image = null;
    // Ensure bubble has a random color when image is cleared
    if (!selectedIdea.color || selectedIdea.color === "black") {
      selectedIdea.color = randomColor();
    }
    document.getElementById("imageSelector").value = "";
    document.getElementById('uploadImage').style.border = '';
    document.getElementById('uploadImage').title = "Upload custom image";
    console.log("ğŸ—‘ï¸ Image cleared from bubble, color set to:", selectedIdea.color);
  }
}

// Test function to debug image upload
function testImageUpload() {
  if (!selectedIdea) {
    alert("Please select a bubble first");
    return;
  }
  
  console.log("ğŸ§ª Testing image upload for bubble at:", selectedIdea.x, selectedIdea.y);
  console.log("ğŸ§ª Current image:", selectedIdea.image ? "has image" : "no image");
  console.log("ğŸ§ª Loaded images count:", Object.keys(loadedImages).length);
  
  // Force reload the current image if it exists
  if (selectedIdea.image) {
    const img = new Image();
    img.onload = () => {
      loadedImages[selectedIdea.image] = img;
      console.log("ğŸ”„ Reloaded image for bubble");
    };
    img.src = selectedIdea.image;
  }
}

// Test function to manually trigger effects
function testEffects() {
  if (!selectedIdea) {
    alert("Please select a bubble first");
    return;
  }
  
  console.log("ğŸ§ª Testing effects for bubble:", selectedIdea.title);
  console.log("ğŸ§ª Current effects:", {
    glow: selectedIdea.glow,
    flash: selectedIdea.flash,
    animateColors: selectedIdea.animateColors,
    transparent: selectedIdea.transparent
  });
  
  // Toggle all effects for testing
  selectedIdea.glow = !selectedIdea.glow;
  selectedIdea.flash = !selectedIdea.flash;
  selectedIdea.animateColors = !selectedIdea.animateColors;
  selectedIdea.transparent = !selectedIdea.transparent;
  
  console.log("ğŸ§ª Effects toggled to:", {
    glow: selectedIdea.glow,
    flash: selectedIdea.flash,
    animateColors: selectedIdea.animateColors,
    transparent: selectedIdea.transparent
  });
}

// Individual effect toggle functions
function toggleGlow() {
  if (!selectedIdea) {
    alert("Please select a bubble first");
    return;
  }
  selectedIdea.glow = !selectedIdea.glow;
  console.log("âœ¨ Glow:", selectedIdea.glow ? "ON" : "OFF");
  
  // Update button appearance
  const button = event.target;
  if (selectedIdea.glow) {
    button.style.background = "linear-gradient(45deg, #FFD700, #FFA500)";
    button.style.color = "black";
  } else {
    button.style.background = "";
    button.style.color = "";
  }
}

function toggleFlash() {
  if (!selectedIdea) {
    alert("Please select a bubble first");
    return;
  }
  selectedIdea.flash = !selectedIdea.flash;
  console.log("âš¡ Flash:", selectedIdea.flash ? "ON" : "OFF");
  
  // Update button appearance
  const button = event.target;
  if (selectedIdea.flash) {
    button.style.background = "linear-gradient(45deg, #FFD700, #FFA500)";
    button.style.color = "black";
  } else {
    button.style.background = "";
    button.style.color = "";
  }
}

function toggleAnimateColors() {
  if (!selectedIdea) {
    alert("Please select a bubble first");
    return;
  }
  selectedIdea.animateColors = !selectedIdea.animateColors;
  console.log("ğŸ¨ Animate:", selectedIdea.animateColors ? "ON" : "OFF");
  
  // Update button appearance
  const button = event.target;
  if (selectedIdea.animateColors) {
    button.style.background = "linear-gradient(45deg, #FFD700, #FFA500)";
    button.style.color = "black";
  } else {
    button.style.background = "";
    button.style.color = "";
  }
}

function toggleTransparent() {
  if (!selectedIdea) {
    alert("Please select a bubble first");
    return;
  }
  selectedIdea.transparent = !selectedIdea.transparent;
  console.log("ğŸ‘» Transparent:", selectedIdea.transparent ? "ON" : "OFF");
  
  // Update button appearance
  const button = event.target;
  if (selectedIdea.transparent) {
    button.style.background = "linear-gradient(45deg, #FFD700, #FFA500)";
    button.style.color = "black";
  } else {
    button.style.background = "";
    button.style.color = "";
  }
}

function changeGlowColor() {
  if (!selectedIdea) {
    alert("Please select a bubble first");
    return;
  }
  
  // Generate a random glow color
  const glowColor = randomColor();
  selectedIdea.glowColor = glowColor;
  
  console.log("ğŸŒˆ Glow color changed to:", glowColor);
  
  // Show visual feedback on the button
  const button = event.target;
  button.style.background = `linear-gradient(45deg, ${glowColor}, ${glowColor}80)`;
  button.style.color = "white";
  
  // Reset button appearance after 1 second
  setTimeout(() => {
    button.style.background = "";
    button.style.color = "";
  }, 1000);
}

function toggleFixed() {
  if (!selectedIdea) {
    alert("Please select a bubble first");
    return;
  }
  selectedIdea.fixed = !selectedIdea.fixed;
  console.log("ğŸ›‘ Fixed:", selectedIdea.fixed ? "ON" : "OFF");
  
  // Update button appearance
  const button = event.target;
  if (selectedIdea.fixed) {
    button.style.background = "linear-gradient(45deg, #FFD700, #FFA500)";
    button.style.color = "black";
  } else {
    button.style.background = "";
    button.style.color = "";
  }
}

function toggleStatic() {
  if (!selectedIdea) {
    alert("Please select a bubble first");
    return;
  }
  selectedIdea.static = !selectedIdea.static;
  console.log("ğŸ›‘ Static:", selectedIdea.static ? "ON" : "OFF");
  
  // Update button appearance
  const button = event.target;
  if (selectedIdea.static) {
    button.style.background = "linear-gradient(45deg, #FFD700, #FFA500)";
    button.style.color = "black";
  } else {
    button.style.background = "";
    button.style.color = "";
  }
}

// Panel management
let panelSide = 'left'; // 'left' or 'right'
let panelFadeTimeout = null;

function togglePanelSide() {
  const panel = document.getElementById('panel');
  if (panelSide === 'left') {
    panel.style.left = 'auto';
    panel.style.right = '15px';
    panelSide = 'right';
    console.log("ğŸ­ Panel moved to right side");
  } else {
    panel.style.right = 'auto';
    panel.style.left = '15px';
    panelSide = 'left';
    console.log("ğŸ­ Panel moved to left side");
  }
}

function resetPanelFade() {
  const panel = document.getElementById('panel');
  if (panel && panel.style.display === 'block') {
    // Clear existing timeout
    if (panelFadeTimeout) {
      clearTimeout(panelFadeTimeout);
    }
    
    // Set new timeout for 30 seconds
    panelFadeTimeout = setTimeout(() => {
      panel.style.opacity = '0';
      setTimeout(() => {
        panel.style.display = 'none';
        panel.style.opacity = '1';
      }, 500); // Fade out over 0.5 seconds
    }, 30000);
  }
}

// Reset panel fade timer on any panel interaction
function resetPanelTimer() {
  if (panel.style.display === 'block') {
    resetPanelFade();
  }
}

    function draw() {
  if (backgroundImage) {
    // Apply background rotation
    if (backgroundRotation !== 0) {
      ctx.save();
      ctx.translate(width / 2, height / 2);
      ctx.rotate((backgroundRotation * Math.PI) / 180);
      // Calculate dimensions to cover the entire screen after rotation
      // Force the image to fill the entire window regardless of aspect ratio
      // For rotated backgrounds, we need to ensure complete coverage
      const maxDimension = Math.max(width, height);
      const minDimension = Math.min(width, height);
      
      // Calculate scale to ensure complete coverage
      const scaleX = width / backgroundImage.width;
      const scaleY = height / backgroundImage.height;
      const scale = Math.max(scaleX, scaleY) * 1.2; // Add 20% extra to ensure coverage
      
      const scaledWidth = backgroundImage.width * scale;
      const scaledHeight = backgroundImage.height * scale;
      
      ctx.drawImage(backgroundImage, -scaledWidth / 2, -scaledHeight / 2, scaledWidth, scaledHeight);
      ctx.restore();
    } else {
      ctx.drawImage(backgroundImage, 0, 0, width, height);
    }
  } else {
    ctx.clearRect(0, 0, width, height);
  }

  for (let i = 0; i < ideas.length; i++) {
    const a = ideas[i];
    const actualSpeed = movementDelayActive ? 0 : speedMultiplier;

    // Movement - fixed and static bubbles don't move automatically
    if (!a.fixed && !a.static) {
      a.x += a.vx * actualSpeed;
      a.y += a.vy * actualSpeed;
    }

    // Boundary bounce - static bubbles don't bounce off boundaries
    if (!a.static) {
      if (a.x - a.radius < border) { a.x = border + a.radius; a.vx *= -1; }
      if (a.x + a.radius > width - border) { a.x = width - border - a.radius; a.vx *= -1; }
      if (a.y - a.radius < border + 50) { a.y = border + 50 + a.radius; a.vy *= -1; }
      if (a.y + a.radius > height - border) { a.y = height - border - a.radius; a.vy *= -1; }
    }

    // Collision detection
    for (let j = i + 1; j < ideas.length; j++) {
      const b = ideas[j];
      const dx = a.x - b.x;
      const dy = a.y - b.y;
      const dist = Math.sqrt(dx * dx + dy * dy);

      if (dist < a.radius + b.radius) {
        const angle = Math.atan2(dy, dx);
        
        // Handle different collision types
        if (a.static && !b.static) {
          // A is static (wall), B bounces off
          const tx = a.x - Math.cos(angle) * (a.radius + b.radius);
          const ty = a.y - Math.sin(angle) * (a.radius + b.radius);
          b.x = tx;
          b.y = ty;
          // Reverse B's velocity
          b.vx *= -1;
          b.vy *= -1;
        } else if (!a.static && b.static) {
          // B is static (wall), A bounces off
          const tx = b.x + Math.cos(angle) * (a.radius + b.radius);
          const ty = b.y + Math.sin(angle) * (a.radius + b.radius);
          a.x = tx;
          a.y = ty;
          // Reverse A's velocity
          a.vx *= -1;
          a.vy *= -1;
        } else {
          // Normal collision (both moving or both fixed)
          const tx = a.x - Math.cos(angle) * (a.radius + b.radius);
          const ty = a.y - Math.sin(angle) * (a.radius + b.radius);
          b.x = tx;
          b.y = ty;
          [a.vx, b.vx] = [b.vx, a.vx];
          [a.vy, b.vy] = [b.vy, a.vy];
        }
      }
    }

    // Gradient glow background (optional)
    const gradient = ctx.createRadialGradient(a.x, a.y, a.radius * 0.6, a.x, a.y, a.radius);
    gradient.addColorStop(0, a.color);
    gradient.addColorStop(1, "black");

    // Begin rendering
    ctx.save();
    ctx.translate(a.x, a.y);
    if (a.rotation) {
      ctx.rotate((a.rotation * Math.PI) / 180);
    }
    ctx.beginPath();
    ctx.arc(0, 0, a.radius, 0, Math.PI * 2);
    ctx.clip();

    if (a.image) {
      const src = a.image;
      
      // Simple image loading - if loaded, draw it; if not, load it
      if (loadedImages[src] && loadedImages[src].complete) {
        try {
          ctx.drawImage(loadedImages[src], -a.radius, -a.radius, a.radius * 2, a.radius * 2);
          console.log("ğŸ–¼ï¸ Drawing image for bubble:", a.title);
        } catch (error) {
          console.error("âŒ Error drawing image for bubble:", a.title, "Error:", error);
          a.image = null;
        }
      } else {
        // Load the image
        if (!loadedImages[src]) {
          console.log("ğŸ”„ Loading image for bubble:", a.title, "Image:", src);
          const img = new Image();
          img.onload = () => {
            loadedImages[src] = img;
            console.log("ğŸ–¼ï¸ Image loaded successfully:", src);
          };
          img.onerror = () => {
            console.error("âŒ Failed to load image:", src);
            a.image = null;
          };
          img.src = src;
        }
        
        // Draw placeholder while loading
        ctx.fillStyle = "rgba(255, 255, 255, 0.3)";
        ctx.fill();
      }
    } else {
      // Handle different fill styles based on effects
      if (a.transparent) {
        ctx.fillStyle = "rgba(255,255,255,0.1)";
        console.log("ğŸ‘» Drawing transparent bubble:", a.title);
      } else if (a.animateColors) {
        ctx.fillStyle = `hsl(${(Date.now() * 0.08) % 360}, 100%, 70%)`;
        console.log("ğŸ¨ Drawing animated color bubble:", a.title);
      } else {
        // Use the bubble's color or gradient
        ctx.fillStyle = a.color || gradient;
      }

      // Apply shadow effects
      if (a.glow) {
        ctx.shadowBlur = 20;
        ctx.shadowColor = a.color || "white";
        console.log("âœ¨ Drawing glow effect for bubble:", a.title);
      } else {
        ctx.shadowBlur = 10;
        ctx.shadowColor = a.color || "white";
      }
      
      ctx.fill();
    }

    ctx.restore();

    // Glow and flash effects (drawn after main bubble so they're visible)
    if (a.glow || a.flash) {
      ctx.save();
      ctx.translate(a.x, a.y);
      if (a.rotation) {
        ctx.rotate((a.rotation * Math.PI) / 180);
      }
      
      // Flash effect
      if (a.flash) {
        ctx.globalAlpha = 0.5 + 0.5 * Math.sin(Date.now() / 100);
        ctx.beginPath();
        ctx.arc(0, 0, a.radius, 0, Math.PI * 2);
        ctx.strokeStyle = "white";
        ctx.lineWidth = 3;
        ctx.stroke();
        console.log("âš¡ Drawing flash effect for bubble:", a.title);
      }
      
      // Glow effect
      if (a.glow) {
        // Use custom glow color if available, otherwise use bubble color
        const glowColor = a.glowColor || a.color || "white";
        
        ctx.globalAlpha = 0.8;
        ctx.shadowColor = glowColor;
        ctx.shadowBlur = 25;
        ctx.beginPath();
        ctx.arc(0, 0, a.radius + 3, 0, Math.PI * 2);
        ctx.strokeStyle = glowColor;
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // Additional outer glow
        ctx.globalAlpha = 0.4;
        ctx.shadowBlur = 15;
        ctx.beginPath();
        ctx.arc(0, 0, a.radius + 5, 0, Math.PI * 2);
        ctx.strokeStyle = glowColor;
        ctx.lineWidth = 1;
        ctx.stroke();
        console.log("âœ¨ Drawing glow effect for bubble:", a.title, "with color:", glowColor);
      }
      
      ctx.restore();
    }

    // Text (drawn last so it's always on top)
    ctx.save();
    ctx.translate(a.x, a.y);
    if (a.rotation) {
      ctx.rotate((a.rotation * Math.PI) / 180);
    }
    ctx.fillStyle = a.textColor || "white";
    const fontSize = a.fontSize || 14;
    ctx.font = `bold ${fontSize}px ${a.font || "Tahoma"}`;
    ctx.textAlign = "center";
    const words = a.title.split(" ");
    const lineHeight = fontSize + 2;
    words.forEach((word, idx) => {
      ctx.fillText(word, 0, idx * lineHeight - (words.length - 1) * (lineHeight / 2));
    });
    ctx.restore();
  }

  requestAnimationFrame(draw);
}
    draw();

    function saveIdeas() {
      const dataToSave = ideas.map(idea => ({ ...idea }));
      const blob = new Blob([JSON.stringify(dataToSave, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "ideas.json";
      a.click();
    }

    document.getElementById("fileLoader").addEventListener("change", function (e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (event) {
    try {
      const loaded = JSON.parse(event.target.result);
      ideas = loaded.map(idea => ({
        ...idea,
        font: idea.font || fonts[0],
        radius: idea.radius || 80,
        fontSize: idea.fontSize || 14,
        rotation: idea.rotation || 0
      }));

      // Delay movement after loading
      movementDelayActive = true;
      setTimeout(() => {
        movementDelayActive = false;
      }, 10000);
    } catch (err) {
      alert("Invalid JSON file.");
    }
  };
  reader.readAsText(file);
});


let isDragging = false;
    let dragOffsetX = 0;
    let dragOffsetY = 0;
    let dragIdea = null;
    let mouseMoved = false;

    canvas.addEventListener("mousedown", (e) => {
      if (speedMultiplier !== 0 || panel.style.display === "block") return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      for (let idea of ideas) {
        const dx = x - idea.x;
        const dy = y - idea.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < idea.radius) {
          isDragging = true;
          dragIdea = idea;
          dragOffsetX = dx;
          dragOffsetY = dy;
          mouseMoved = false;
          return;
        }
      }
    });

    canvas.addEventListener("mousemove", (e) => {
      if (isDragging && dragIdea && speedMultiplier === 0) {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        dragIdea.x = x - dragOffsetX;
        dragIdea.y = y - dragOffsetY;
        mouseMoved = true;
      }
    });

    canvas.addEventListener("mouseup", (e) => {
      if (isDragging && dragIdea && !mouseMoved) {
        selectedIdea = dragIdea;
        showPanel();
      }
      isDragging = false;
      dragIdea = null;
    });
    
    // Add media toolbar event listeners
    document.getElementById("bgLoader").addEventListener("change", function (e) {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function (event) {
        const img = new Image();
        img.onload = function () {
          backgroundImage = img;
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    document.getElementById("videoLoader").addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (!file) return;

      const video = document.getElementById("bgVideo");
      const iframe = document.getElementById("ytFrame");

      backgroundImage = null;
      iframe.style.display = "none";
      iframe.src = "";

      const objectURL = URL.createObjectURL(file);
      video.src = objectURL;
      video.style.display = "block";

      video.load();

      setTimeout(() => {
        video.play().then(() => {
          console.log("Video playing as background.");
        }).catch((err) => {
          console.warn("Autoplay blocked, trying again on user interaction:", err);
          document.body.addEventListener("click", () => video.play(), { once: true });
        });
      }, 100);
    });
    
    // Add upload image listener
    document.getElementById('uploadImage').addEventListener('change', function (e) {
      console.log("ğŸ“ Upload event triggered!");
      const file = e.target.files[0];
      if (!file || !file.type.startsWith('image/')) {
        alert("Please select a valid image file.");
        return;
      }

      if (!selectedIdea) {
        alert("Please click on a bubble first to upload an image to it.");
        return;
      }

      console.log("ğŸ“ Starting upload for file:", file.name, "size:", file.size, "type:", file.type);

      const reader = new FileReader();
      reader.onload = function (event) {
        const imageData = event.target.result;
        console.log("ğŸ“ File read successfully, size:", imageData.length);
        
        // Preload the image first
        const img = new Image();
        img.crossOrigin = "anonymous"; // Handle CORS issues
        
        img.onload = () => {
          console.log("ğŸ–¼ï¸ Image loaded successfully:", img.width, "x", img.height);
          
          // Validate the image dimensions
          if (img.width === 0 || img.height === 0) {
            console.error("âŒ Invalid image dimensions");
            alert("Invalid image file. Please try a different image.");
            return;
          }
          
          // Only set the image after it's successfully loaded
          selectedIdea.image = imageData;
          loadedImages[imageData] = img;
          
          console.log("âœ… Image uploaded and stored for this bubble.");
          console.log("ğŸ¯ Bubble position:", selectedIdea.x, selectedIdea.y);
          console.log("ğŸ“Š Total loaded images:", Object.keys(loadedImages).length);
          console.log("ğŸ–¼ï¸ Image data length:", imageData.length);
          console.log("ğŸ–¼ï¸ Image dimensions:", img.width, "x", img.height);
          
          // Show success feedback
          const uploadInput = document.getElementById('uploadImage');
          uploadInput.style.border = '2px solid green';
          uploadInput.title = "Image uploaded successfully!";
          
          setTimeout(() => {
            uploadInput.style.border = '';
            uploadInput.title = "Upload custom image";
          }, 2000);
          
          // Force immediate redraw
          requestAnimationFrame(() => {
            console.log("ğŸ”„ Forcing redraw after upload");
          });
        };
        
        img.onerror = (error) => {
          console.error("âŒ Failed to load uploaded image:", error);
          alert("Failed to load the uploaded image. Please try again.");
        };
        
        // Set the source after setting up event handlers
        img.src = imageData;
      };

      reader.onerror = function(error) {
        console.error("âŒ FileReader error:", error);
        alert("Error reading the file. Please try again.");
      };

      reader.readAsDataURL(file);
    });
    
    // Add dropdown image selector listener
    document.getElementById('imageSelector').addEventListener('change', function (e) {
      console.log("ğŸ–¼ï¸ Dropdown changed, selectedIdea:", selectedIdea ? selectedIdea.title : "none");
      if (selectedIdea) {
        const value = e.target.value || null;
        selectedIdea.image = value;
        console.log("ğŸ–¼ï¸ Selected from dropdown:", value || "none");
        console.log("ğŸ–¼ï¸ Bubble title:", selectedIdea.title);
        
        // If "None" is selected, ensure bubble has a random color
        if (!value || value === "") {
          if (!selectedIdea.color || selectedIdea.color === "black") {
            selectedIdea.color = randomColor();
            console.log("ğŸ¨ Reset color to:", selectedIdea.color);
          }
        }
        
        // Preload the image if it's not already loaded
        if (value && !loadedImages[value]) {
          console.log("ğŸ”„ Loading dropdown image:", value);
          const img = new Image();
          img.crossOrigin = "anonymous";
          img.onload = () => {
            loadedImages[value] = img;
            console.log("ğŸ–¼ï¸ Dropdown image loaded successfully:", value);
            console.log("ğŸ–¼ï¸ Image dimensions:", img.width, "x", img.height);
            console.log("ğŸ–¼ï¸ Total loaded images:", Object.keys(loadedImages).length);
          };
          img.onerror = () => {
            console.error("âŒ Failed to load dropdown image:", value);
            selectedIdea.image = null;
            delete loadedImages[value];
          };
          img.src = value;
        } else if (value && loadedImages[value]) {
          console.log("ğŸ–¼ï¸ Dropdown image already loaded:", value);
          console.log("ğŸ–¼ï¸ Image dimensions:", loadedImages[value].width, "x", loadedImages[value].height);
        }
      } else {
        console.log("âŒ No selectedIdea when dropdown changed");
      }
    });
    
    function loadYouTubeVideo() {
      const url = document.getElementById("youtubeLink").value;
      const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^\s&]+)/);
      const video = document.getElementById("bgVideo");
      const iframe = document.getElementById("ytFrame");
      if (match) {
        const videoId = match[1];
        const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&controls=0&loop=1&playlist=${videoId}`;
        backgroundImage = null;
        video.style.display = "none";
        video.pause();
        iframe.src = embedUrl;
        iframe.style.display = "block";
      } else {
        alert("Invalid YouTube URL.");
      }
    }

    function clearBackground() {
      backgroundImage = null;
      document.getElementById("bgVideo").style.display = "none";
      document.getElementById("bgVideo").pause();
      document.getElementById("ytFrame").style.display = "none";
      document.getElementById("ytFrame").src = "";
    }
    function deleteAllIdeas() {
  if (confirm("ğŸ“‹CREATE BLANK CANVAS? âœ…")) {
    // Clear all ideas
    ideas = [];
    selectedIdea = null;
    panel.style.display = "none";

    // Reset background image
    backgroundImage = null;

    // Reset video
    const video = document.getElementById("bgVideo");
    video.style.display = "none";
    video.pause();
    video.src = "";

    // Reset YouTube iframe
    const iframe = document.getElementById("ytFrame");
    iframe.style.display = "none";
    iframe.src = "";
  }
}

    // Initial Ideas
    ideas = [
  {
    "title": "",
    "description": "3-1 at Home Park",
    "x": 76,
    "y": 107.92193177015054,
    "vx": 1.7916159179163342,
    "vy": 1.814208650607946,
    "color": "green",
    "textColor": "black",
    "radius": 32,
    "font": "Arial",
    "image": "images/a6.png",
    "flash": false,
    "static": true,
    "fontSize": 14,
    "rotation": 0,
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 1305.331262652005,
    "y": 650.7672065322456,
    "vx": 2.8913980850556573,
    "vy": 2.944397012348978,
    "color": "hsl(169.5204249808646, 100%, 70%)",
    "textColor": "white",
    "radius": 38,
    "font": "Arial",
    "image": "images/a11.png",
    "fontSize": 14,
    "rotation": 0,
    "glow": true
  },
  {
    "title": "      Sorinola",
    "description": "",
    "x": 518.1016037429536,
    "y": 250.23829438430857,
    "vx": 1.649079753654305,
    "vy": -2.8256139799654356,
    "color": "hsl(106.0048409709453, 100%, 70%)",
    "textColor": "lime",
    "radius": 35,
    "font": "Arial",
    "image": "images/a29.png",
    "glow": true,
    "fontSize": 10,
    "rotation": 0
  },
  {
    "title": "      OwenO",
    "description": "",
    "x": 475.7629111484698,
    "y": 113.08669591042815,
    "vx": -1.1525288168916539,
    "vy": 0.8009637309900604,
    "color": "hsl(106.0048409709453, 100%, 70%)",
    "textColor": "white",
    "radius": 36,
    "font": "Arial",
    "image": "images/a18.png",
    "glow": true,
    "fontSize": 11,
    "static": true,
    "rotation": 0
  },
  {
    "title": "      Wiredu",
    "description": "",
    "x": 896.4848485717739,
    "y": 354.1892660067506,
    "vx": 1.4314693203590225,
    "vy": 2.0794291091997867,
    "color": "hsl(252.82353685903811, 100%, 70%)",
    "textColor": "black",
    "radius": 38,
    "font": "Arial",
    "image": "images/a4.png",
    "flash": false,
    "glow": true,
    "fontSize": 11,
    "glowColor": "hsl(86.97667587332688, 100%, 70%)",
    "rotation": 0
  },
  {
    "title": "     5.Pleguezuelo",
    "description": "",
    "x": 439.68051592735304,
    "y": 561.4731384825486,
    "vx": 1.882214795057802,
    "vy": 2.070210111510945,
    "color": "hsl(146.91765164925442, 100%, 70%)",
    "textColor": "yellow",
    "radius": 38,
    "font": "Trebuchet MS",
    "image": "images/a5.png",
    "glow": true,
    "fontSize": 10,
    "rotation": 0
  },
  {
    "title": "11.Bali       Mumba",
    "description": "",
    "x": 1372.8454765446984,
    "y": 277.62998560001427,
    "vx": -2.17444995509932,
    "vy": 2.158829730837228,
    "color": "hsl(96.72915377921444, 100%, 70%)",
    "textColor": "yellow",
    "radius": 36,
    "font": "Trebuchet MS",
    "image": "images/a2.png",
    "glow": true,
    "fontSize": 8,
    "rotation": 0
  },
  {
    "title": "      10. Amaechi",
    "description": "",
    "x": 1398.8963915923223,
    "y": 461.6236119900749,
    "vx": 1.0521794313957362,
    "vy": 0.11027968113262254,
    "color": "hsl(252.34171552918932, 100%, 70%)",
    "textColor": "white",
    "radius": 42,
    "font": "Arial",
    "image": "images/a10.png",
    "glow": true,
    "glowColor": "hsl(111.95392761392809, 100%, 70%)",
    "fontSize": 11,
    "rotation": 0
  },
  {
    "title": "      Galloway",
    "description": "",
    "x": 443.18733290008004,
    "y": 371.9845896072569,
    "vx": 1.9729551240392345,
    "vy": 2.5314653797664977,
    "color": "hsl(89.83617564464495, 100%, 70%)",
    "textColor": "yellow",
    "radius": 38,
    "font": "Impact",
    "image": "images/a9.png",
    "fontSize": 11,
    "rotation": 0,
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 161.80824276301607,
    "y": 466.05271862023034,
    "vx": 2.555616986936294,
    "vy": -0.2387138134250082,
    "color": "hsl(24.307170121348456, 100%, 70%)",
    "textColor": "white",
    "radius": 35,
    "font": "Arial",
    "image": "images/a1.png",
    "glow": true,
    "fixed": true,
    "static": true,
    "transparent": false,
    "animateColors": false,
    "fontSize": 12,
    "rotation": 0
  },
  {
    "title": "",
    "description": "",
    "x": 896.7495003371318,
    "y": 556.6517934406206,
    "vx": -1.407297446757279,
    "vy": 0.9508855279663337,
    "color": "hsl(351.41143663281053, 100%, 70%)",
    "textColor": "white",
    "radius": 41,
    "font": "Arial",
    "image": "images/a17.png",
    "glow": true,
    "rotation": 352,
    "fontSize": 14
  },
  {
    "title": "",
    "description": "",
    "x": 1472.6337772852796,
    "y": 710.4466776731686,
    "vx": 2.897184152429392,
    "vy": 2.241689214399569,
    "color": "hsl(66.39945239408976, 100%, 70%)",
    "textColor": "white",
    "radius": 10,
    "font": "Arial",
    "image": "images/a21.png",
    "glow": true,
    "fontSize": 14,
    "rotation": 0
  },
  {
    "title": "   Paterson",
    "description": "",
    "x": 1130.871165475693,
    "y": 448.7760102532868,
    "vx": -2.238481215005998,
    "vy": -0.29852795372246255,
    "color": "hsl(204.05950274274593, 100%, 70%)",
    "textColor": "white",
    "radius": 39,
    "font": "Arial",
    "image": "images/a7.png",
    "flash": false,
    "glow": true,
    "fontSize": 14,
    "rotation": 0
  },
  {
    "title": "      (c)Joe Edwards",
    "description": "",
    "x": 532.2751963337748,
    "y": 672.7645440149813,
    "vx": -2.727582905818548,
    "vy": 2.020265480956251,
    "color": "hsl(112.74450176357617, 100%, 70%)",
    "textColor": "hsl(138, 100%, 50.64142845200115%)",
    "radius": 38,
    "font": "Monaco",
    "image": "images/a8.png",
    "glow": true,
    "fontSize": 9,
    "rotation": 0
  },
  {
    "title": "",
    "description": "",
    "x": 1124.5623762703397,
    "y": 561.5997629774469,
    "vx": 1.3992001763953028,
    "vy": 2.567039910572836,
    "color": "hsl(125.97890321544668, 100%, 70%)",
    "textColor": "white",
    "radius": 10,
    "font": "Arial",
    "image": "images/a23.png",
    "glow": true,
    "flash": false,
    "fontSize": 14,
    "rotation": 0
  },
  {
    "title": "",
    "description": "",
    "x": 1153.7853218951363,
    "y": 108.85362859682164,
    "vx": -2.8291296197913907,
    "vy": -2.68221094647182,
    "color": "hsl(37.62768643513751, 100%, 70%)",
    "textColor": "white",
    "radius": 35,
    "font": "Arial",
    "image": "images/a27.png",
    "static": true,
    "fontSize": 14,
    "rotation": 0
  },
  {
    "title": "",
    "description": "",
    "x": 608.5662033051118,
    "y": 894.9142390938317,
    "vx": 1.8414992163861779,
    "vy": -0.5470138346575946,
    "color": "hsl(153.96142025185642, 100%, 70%)",
    "textColor": "white",
    "radius": 10,
    "font": "Arial",
    "image": "images/a20.png",
    "glow": true,
    "fontSize": 14,
    "rotation": 0,
    "glowColor": "hsl(108.82161579515511, 100%, 70%)"
  },
  {
    "title": "",
    "description": "",
    "x": 1723.0003539597624,
    "y": 453.490196078431,
    "vx": -1.3005688681209613,
    "vy": -2.5865243312150525,
    "color": "hsl(266.80831007995465, 100%, 70%)",
    "textColor": "white",
    "radius": 36,
    "font": "Arial",
    "image": "images/a13.png",
    "glow": true,
    "fixed": true,
    "fontSize": 14,
    "rotation": 0,
    "static": true
  },
  {
    "title": "",
    "description": "",
    "x": 1596.3635016648084,
    "y": 132.74842259854154,
    "vx": -0.5723384563789395,
    "vy": 2.7988764134555977,
    "color": "hsl(193.52566759469707, 100%, 70%)",
    "textColor": "white",
    "radius": 32,
    "font": "Arial",
    "image": "images/a19.png",
    "glow": true,
    "static": true,
    "fontSize": 14,
    "rotation": 0
  },
  {
    "title": "",
    "description": "",
    "x": 951.7100407001084,
    "y": 130.77963246457324,
    "vx": -2.555616986936294,
    "vy": 0.2387138134250082,
    "color": "hsl(231.7055957100566, 100%, 70%)",
    "textColor": "white",
    "radius": 38,
    "font": "Arial",
    "image": "images/a24.png",
    "glow": true,
    "fixed": false,
    "static": true,
    "fontSize": 14,
    "rotation": 0
  },
  {
    "title": "",
    "description": "",
    "x": 1225.8880318036959,
    "y": 873.1987920029824,
    "vx": -0.9451692738006636,
    "vy": -0.33023958137795817,
    "color": "hsl(309.71138499031537, 100%, 70%)",
    "textColor": "white",
    "radius": 10,
    "font": "Arial",
    "image": "images/a22.png",
    "fontSize": 14,
    "rotation": 0
  },
  {
    "title": "",
    "description": "",
    "x": 1485.864259480758,
    "y": 209.32087042576467,
    "vx": -1.468891257262151,
    "vy": -0.8990467368423358,
    "color": "hsl(333.65800721281323, 100%, 70%)",
    "textColor": "white",
    "radius": 10,
    "font": "Arial",
    "image": "images/a21.png",
    "glow": false,
    "fontSize": 14,
    "rotation": 0,
    "glowColor": "hsl(95.78011305688119, 100%, 70%)"
  },
  {
    "title": "",
    "description": "",
    "x": 1371.4068471111611,
    "y": 103.5101104394065,
    "vx": -1.260720341360491,
    "vy": 1.203145322799383,
    "color": "hsl(107.23473760146486, 100%, 70%)",
    "textColor": "white",
    "radius": 29,
    "font": "Arial",
    "image": "images/a28.png",
    "glow": true,
    "static": true,
    "fontSize": 14,
    "rotation": 0
  }  
]

// Define theme presets after initial ideas are set up
const themePresets = {
      default: {
        ideas: [...ideas],
        bg: "images/default1.png"
      },
      cqc: {
        ideas: [
  {
    "title": "",
    "description": "",
    "x": 358.2527121369603,
    "y": 346.45703270124443,
    "vx": 0.35151055673423004,
    "vy": 2.435546891874921,
    "color": "hsl(67.26192022230275, 100%, 70%)",
    "textColor": "white",
    "radius": 62,
    "font": "Arial",
    "image": "images/l3.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 1564.8067554662866,
    "y": 327.2753317834405,
    "vx": -1.9878765749481846,
    "vy": 2.492252820118642,
    "color": "hsl(139.91524203693803, 100%, 70%)",
    "textColor": "white",
    "radius": 68,
    "font": "Arial",
    "image": "images/l4.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 431,
    "y": 748,
    "vx": 1.1614214205776796,
    "vy": -2.2367504485206355,
    "color": "hsl(191.89806599193358, 100%, 70%)",
    "textColor": "white",
    "radius": 60,
    "font": "Arial",
    "image": "images/l2.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 1750,
    "y": 538,
    "vx": -2.6853774613163797,
    "vy": -2.7259476366710977,
    "color": "hsl(127.23694310531901, 100%, 70%)",
    "textColor": "white",
    "radius": 63,
    "font": "Arial",
    "image": "images/l5.png"
  },
  {
    "title": "",
    "description": "",
    "x": 1433,
    "y": 741,
    "vx": 2.4617753958229622,
    "vy": 2.510897540099248,
    "color": "hsl(334.34575693904037, 100%, 70%)",
    "textColor": "white",
    "radius": 63,
    "font": "Arial",
    "image": "images/l8.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 129,
    "y": 527,
    "vx": -0.6861455142184185,
    "vy": -2.6954829203378177,
    "color": "hsl(217.30224307389682, 100%, 70%)",
    "textColor": "white",
    "radius": 69,
    "font": "Arial",
    "image": "images/l7.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 960,
    "y": 851,
    "vx": -1.0933425054687722,
    "vy": 1.9117263286194006,
    "color": "hsl(254.0872352592045, 100%, 70%)",
    "textColor": "white",
    "radius": 59,
    "font": "Arial",
    "image": "images/l1.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 946,
    "y": 292,
    "vx": 1.078293018313335,
    "vy": -0.13113271942065707,
    "color": "hsl(319.5115481470086, 100%, 70%)",
    "textColor": "white",
    "radius": 80,
    "font": "Arial",
    "image": "images/l26.png"
  },
  {
    "title": "",
    "description": "",
    "x": 223.12944639313582,
    "y": 613.7389608060978,
    "vx": -1.0343116528841743,
    "vy": 1.9520595917203052,
    "color": "hsl(321.6047791937284, 100%, 70%)",
    "textColor": "white",
    "radius": 59,
    "font": "Arial",
    "image": "images/l26.png"
  },
  {
    "title": "",
    "description": "",
    "x": 831,
    "y": 465,
    "vx": -2.7164527841027692,
    "vy": 2.5971470318095813,
    "color": "hsl(2.18992732131281, 100%, 70%)",
    "textColor": "white",
    "radius": 55,
    "font": "Arial",
    "image": "images/l12.png",
    "glow": true
  }
],
        bg: "images/cqc1.png"
      },
      argyle: {
        ideas: [
  {
    "title": "",
    "description": "3-1 at Home Park",
    "x": 438.8647105177631,
    "y": 348.4802222717975,
    "vx": 1.260720341360491,
    "vy": -1.203145322799383,
    "color": "green",
    "textColor": "black",
    "radius": 54,
    "font": "Arial",
    "image": "images/a6.png",
    "flash": false
  },
  {
    "title": "",
    "description": "",
    "x": 1129.8229595345738,
    "y": 670.4869481845279,
    "vx": -0.5723384563789395,
    "vy": -2.7988764134555977,
    "color": "hsl(169.5204249808646, 100%, 70%)",
    "textColor": "white",
    "radius": 54,
    "font": "Arial",
    "image": "images/a11.png"
  },
  {
    "title": "      Sorinola",
    "description": "",
    "x": 560.578741411884,
    "y": 246.52958140650912,
    "vx": -2.555616986936294,
    "vy": 0.2387138134250082,
    "color": "hsl(106.0048409709453, 100%, 70%)",
    "textColor": "lime",
    "radius": 50,
    "font": "Arial",
    "image": "images/a29.png",
    "glow": true
  },
  {
    "title": "      OwenO",
    "description": "",
    "x": 510.578741411884,
    "y": 146.52958140650912,
    "vx": -1.3992001763953028,
    "vy": 2.567039910572836,
    "color": "hsl(106.0048409709453, 100%, 70%)",
    "textColor": "white",
    "radius": 49,
    "font": "Arial",
    "image": "images/a18.png",
    "glow": true
  },
  {
    "title": "      Wiredu",
    "description": "",
    "x": 938.0577758440062,
    "y": 381.4751947554653,
    "vx": 1.4314693203590225,
    "vy": 2.0794291091997867,
    "color": "hsl(252.82353685903811, 100%, 70%)",
    "textColor": "black",
    "radius": 50,
    "font": "Arial",
    "image": "images/a4.png",
    "flash": false,
    "glow": true
  },
  {
    "title": "    5.Pleguezuelo",
    "description": "",
    "x": 441.45665488003056,
    "y": 603.3223767774596,
    "vx": 2.897184152429392,
    "vy": 2.241689214399569,
    "color": "hsl(146.91765164925442, 100%, 70%)",
    "textColor": "yellow",
    "radius": 52,
    "font": "Trebuchet MS",
    "image": "images/a5.png",
    "glow": true
  },
  {
    "title": "Bali     Mumba",
    "description": "",
    "x": 1106.567292080782,
    "y": 273.83790640802437,
    "vx": -1.6989220135694567,
    "vy": -0.2812933931466559,
    "color": "hsl(96.72915377921444, 100%, 70%)",
    "textColor": "yellow",
    "radius": 48,
    "font": "Lucida Sans Unicode",
    "image": "images/a2.png",
    "glow": true
  },
  {
    "title": "      10. Amaechi",
    "description": "",
    "x": 1445.037263776416,
    "y": 452.3373631154707,
    "vx": 1.882214795057802,
    "vy": -2.070210111510945,
    "color": "hsl(252.34171552918932, 100%, 70%)",
    "textColor": "white",
    "radius": 49,
    "font": "Arial",
    "image": "images/a10.png",
    "glow": true
  },
  {
    "title": "      Galloway",
    "description": "",
    "x": 407.955577031997,
    "y": 129.6628646940399,
    "vx": -2.555616986936294,
    "vy": 0.2387138134250082,
    "color": "hsl(89.83617564464495, 100%, 70%)",
    "textColor": "yellow",
    "radius": 55,
    "font": "Courier New",
    "image": "images/a9.png"
  },
  {
    "title": "",
    "description": "",
    "x": 198.14796761454,
    "y": 469.54132550880917,
    "vx": -1.649079753654305,
    "vy": -2.8256139799654356,
    "color": "hsl(24.307170121348456, 100%, 70%)",
    "textColor": "white",
    "radius": 69,
    "font": "Arial",
    "image": "images/a1.png",
    "glow": true
  },
  {
    "title": "     Watts",
    "description": "",
    "x": 955.7553280596137,
    "y": 551.4576757404113,
    "vx": 1.8414992163861779,
    "vy": -0.5470138346575946,
    "color": "hsl(351.41143663281053, 100%, 70%)",
    "textColor": "white",
    "radius": 49,
    "font": "Arial",
    "image": "images/a17.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 516.847968946306,
    "y": 436.915942134623,
    "vx": 2.5038823180659646,
    "vy": -2.706633593745956,
    "color": "hsl(66.39945239408976, 100%, 70%)",
    "textColor": "white",
    "radius": 18,
    "font": "Arial",
    "image": "images/a21.png",
    "glow": true
  },
  {
    "title": "   Paterson",
    "description": "",
    "x": 1257.597551645393,
    "y": 450.26344220282056,
    "vx": -2.727582905818548,
    "vy": 2.020265480956251,
    "color": "hsl(204.05950274274593, 100%, 70%)",
    "textColor": "white",
    "radius": 53,
    "font": "Arial",
    "image": "images/a7.png",
    "flash": false,
    "glow": true
  },
  {
    "title": "     (c)Joe Edwards",
    "description": "",
    "x": 627.8219585551415,
    "y": 669.0833596944369,
    "vx": -1.3005688681209613,
    "vy": -2.5865243312150525,
    "color": "hsl(112.74450176357617, 100%, 70%)",
    "textColor": "white",
    "radius": 57,
    "font": "Tahoma",
    "image": "images/a8.png",
    "glow": false
  },
  {
    "title": "",
    "description": "",
    "x": 1088.7569876688044,
    "y": 464.5166715074256,
    "vx": 1.9729551240392345,
    "vy": 2.5314653797664977,
    "color": "hsl(125.97890321544668, 100%, 70%)",
    "textColor": "white",
    "radius": 21,
    "font": "Arial",
    "image": "images/a23.png",
    "glow": false,
    "flash": false
  },
  {
    "title": "",
    "description": "",
    "x": 792.0925068107239,
    "y": 143.84931037872525,
    "vx": -1.1525288168916539,
    "vy": -0.8009637309900604,
    "color": "hsl(37.62768643513751, 100%, 70%)",
    "textColor": "white",
    "radius": 53,
    "font": "Arial",
    "image": "images/a19.png"
  },
  {
    "title": "",
    "description": "",
    "x": 666.3877961801683,
    "y": 136.09534643020598,
    "vx": 2.8913980850556573,
    "vy": 2.944397012348978,
    "color": "hsl(330.16318962145965, 100%, 70%)",
    "textColor": "white",
    "radius": 49,
    "font": "Arial",
    "image": "images/a16.png"
  },
  {
    "title": "",
    "description": "",
    "x": 1074.3261702804978,
    "y": 144.8519822234622,
    "vx": 0.6616969681492546,
    "vy": 2.9752644521069236,
    "color": "hsl(262.2434224951693, 100%, 70%)",
    "textColor": "white",
    "radius": 49,
    "font": "Arial",
    "image": "images/a15.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 1521.0362919964402,
    "y": 451.95303303344804,
    "vx": 1.0521794313957362,
    "vy": 0.11027968113262254,
    "color": "hsl(153.96142025185642, 100%, 70%)",
    "textColor": "white",
    "radius": 19,
    "font": "Arial",
    "image": "images/a21.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 1789.2944716068205,
    "y": 445.64705882352945,
    "vx": 1,
    "vy": 1,
    "color": "hsl(266.80831007995465, 100%, 70%)",
    "textColor": "white",
    "radius": 60,
    "font": "Arial",
    "image": "images/a13.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 261,
    "y": 151,
    "vx": -1.7916159179163342,
    "vy": -1.814208650607946,
    "color": "hsl(123.97262968121507, 100%, 70%)",
    "textColor": "white",
    "radius": 53,
    "font": "Arial",
    "image": "images/a27.png"
  },
  {
    "title": "",
    "description": "",
    "x": 1455,
    "y": 147,
    "vx": -2.238481215005998,
    "vy": 0.29852795372246255,
    "color": "hsl(289.09439844980164, 100%, 70%)",
    "textColor": "white",
    "radius": 52,
    "font": "Arial",
    "image": "images/a3.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 1679,
    "y": 140,
    "vx": 1.6692620465932226,
    "vy": 1.4014624045013233,
    "color": "hsl(131.17772009651742, 100%, 70%)",
    "textColor": "white",
    "radius": 51,
    "font": "Arial",
    "image": "images/a12.png"
  },
  {
    "title": "",
    "description": "",
    "x": 1808,
    "y": 162.80347676483115,
    "vx": 2.17444995509932,
    "vy": -2.158829730837228,
    "color": "hsl(193.52566759469707, 100%, 70%)",
    "textColor": "white",
    "radius": 45,
    "font": "Arial",
    "image": "images/a14.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 935,
    "y": 156,
    "vx": 1.4578020622274135,
    "vy": -0.6168881712837142,
    "color": "hsl(231.7055957100566, 100%, 70%)",
    "textColor": "white",
    "radius": 47,
    "font": "Arial",
    "image": "images/a24.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 465,
    "y": 851,
    "vx": -1.4896968586849564,
    "vy": -0.7193082100144297,
    "color": "hsl(309.71138499031537, 100%, 70%)",
    "textColor": "white",
    "radius": 23,
    "font": "Arial",
    "image": "images/a22.png"
  },
  {
    "title": "",
    "description": "",
    "x": 1239,
    "y": 869,
    "vx": 2.6016753721500203,
    "vy": 2.588206634360777,
    "color": "hsl(333.65800721281323, 100%, 70%)",
    "textColor": "white",
    "radius": 25,
    "font": "Arial",
    "image": "images/a20.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 1568,
    "y": 150,
    "vx": -0.9451692738006636,
    "vy": 0.33023958137795817,
    "color": "hsl(107.23473760146486, 100%, 70%)",
    "textColor": "white",
    "radius": 43,
    "font": "Arial",
    "image": "images/a28.png",
    "glow": true
  },
  {
    "title": "    ğŸ¥´",
    "description": "",
    "x": 156,
    "y": 863,
    "vx": -2.072437325436896,
    "vy": -1.1163445905347469,
    "color": "hsl(159.40913970088886, 100%, 70%)",
    "textColor": "white",
    "radius": 30,
    "font": "Arial",
    "image": "images/l1.png"
  },
  {
    "title": "",
    "description": "",
    "x": 587,
    "y": 872,
    "vx": -1.027862752918072,
    "vy": -0.4120701078240161,
    "color": "hsl(98.29444726823058, 100%, 70%)",
    "textColor": "white",
    "radius": 26,
    "font": "Arial",
    "image": "images/l2.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 1343.813374658076,
    "y": 862.7424850950403,
    "vx": 1.1147252477300964,
    "vy": 0.8298506162096455,
    "color": "hsl(293.29099042786623, 100%, 70%)",
    "textColor": "white",
    "radius": 30,
    "font": "Arial",
    "image": "images/l3.png"
  },
  {
    "title": "",
    "description": "",
    "x": 1087,
    "y": 869,
    "vx": -0.15616542679438306,
    "vy": -0.008555117304012594,
    "color": "hsl(319.89204294923053, 100%, 70%)",
    "textColor": "white",
    "radius": 30,
    "font": "Arial",
    "image": "images/l4.png",
    "glow": false
  },
  {
    "title": "",
    "description": "",
    "x": 736,
    "y": 879,
    "vx": 0.1835536004123477,
    "vy": -1.138249276448782,
    "color": "hsl(81.72732338762596, 100%, 70%)",
    "textColor": "white",
    "radius": 30,
    "font": "Arial",
    "image": "images/l5.png"
  },
  {
    "title": "   ğŸ’š",
    "description": "",
    "x": 1546,
    "y": 862,
    "vx": -1.3491774110122876,
    "vy": -2.166746380815313,
    "color": "hsl(296.5958619272866, 100%, 70%)",
    "textColor": "white",
    "radius": 30,
    "font": "Arial",
    "image": "images/l7.png",
    "glow": false
  },
  {
    "title": "   ğŸ’š",
    "description": "",
    "x": 265.98995754779486,
    "y": 864.4863507776729,
    "vx": 1.4992230691735136,
    "vy": -2.6373370895124104,
    "color": "hsl(207.36129024560415, 100%, 70%)",
    "textColor": "white",
    "radius": 25,
    "font": "Arial",
    "image": "images/l12.png"
  },
  {
    "title": "",
    "description": "",
    "x": 1653,
    "y": 821,
    "vx": -2.3769488955395275,
    "vy": -0.331982879982647,
    "color": "hsl(43.294021276490106, 100%, 70%)",
    "textColor": "white",
    "radius": 28,
    "font": "Arial",
    "image": "images/l18.png"
  },
  {
    "title": "",
    "description": "",
    "x": 899,
    "y": 842,
    "vx": 2.2573948883164534,
    "vy": -2.3070582530520505,
    "color": "hsl(307.06568398222214, 100%, 70%)",
    "textColor": "white",
    "radius": 26,
    "font": "Arial",
    "image": "images/l19.png"
  },
  {
    "title": "",
    "description": "",
    "x": 812.0844431309924,
    "y": 879,
    "vx": 2.9427255133597914,
    "vy": 2.3744452497319144,
    "color": "hsl(245.47608978475924, 100%, 70%)",
    "textColor": "white",
    "radius": 26,
    "font": "Arial",
    "image": "images/l8.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 1776,
    "y": 872,
    "vx": 1.391073563636182,
    "vy": 1.4786463661577096,
    "color": "hsl(131.84539300549514, 100%, 70%)",
    "textColor": "white",
    "radius": 30,
    "font": "Arial",
    "image": "images/l21.png"
  },
  {
    "title": "",
    "description": "",
    "x": 369.74590641779594,
    "y": 879,
    "vx": 1.351437321304037,
    "vy": -2.285399734149542,
    "color": "hsl(217.01069722739922, 100%, 70%)",
    "textColor": "white",
    "radius": 28,
    "font": "Arial",
    "image": "images/l17.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 994.0721245529277,
    "y": 879,
    "vx": 1.8469344987920049,
    "vy": 1.2619585345871676,
    "color": "hsl(119.99668409208992, 100%, 70%)",
    "textColor": "white",
    "radius": 27,
    "font": "Arial",
    "image": "images/l16.png"
  },
  {
    "title": "",
    "description": "",
    "x": 1438.2804636234243,
    "y": 879,
    "vx": 2.4620901960485204,
    "vy": -0.5307034114014588,
    "color": "hsl(254.0189761976136, 100%, 70%)",
    "textColor": "white",
    "radius": 27,
    "font": "Arial",
    "image": "images/l13.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 90,
    "y": 775,
    "vx": 0.2616134631963316,
    "vy": 0.8628772201404149,
    "color": "hsl(14.412267997899564, 100%, 70%)",
    "textColor": "white",
    "radius": 29,
    "font": "Arial",
    "image": "images/l15.png"
  },
  {
    "title": "",
    "description": "",
    "x": 1808,
    "y": 758,
    "vx": -1.50084816025744,
    "vy": -2.207895821745506,
    "color": "hsl(286.7309682731214, 100%, 70%)",
    "textColor": "white",
    "radius": 28,
    "font": "Arial",
    "image": "images/l23.png"
  },
  {
    "title": "",
    "description": "",
    "x": 90,
    "y": 645,
    "vx": 1.6959157039505797,
    "vy": -2.073207008971993,
    "color": "hsl(105.63358556606337, 100%, 70%)",
    "textColor": "white",
    "radius": 29,
    "font": "Arial",
    "image": "images/l24.png"
  },
  {
    "title": "",
    "description": "",
    "x": 1807,
    "y": 645,
    "vx": -1.7960270776735168,
    "vy": 1.050090013839172,
    "color": "hsl(343.74882967716053, 100%, 70%)",
    "textColor": "white",
    "radius": 27,
    "font": "Arial",
    "image": "images/l33.png"
  },
  {
    "title": "",
    "description": "",
    "x": 1799.2666541181036,
    "y": 536.2798268298305,
    "vx": 0.7570994484197298,
    "vy": 2.164920459798174,
    "color": "hsl(266.6899921871529, 100%, 70%)",
    "textColor": "white",
    "radius": 22,
    "font": "Arial",
    "image": "images/l29.png"
  },
  {
    "title": "",
    "description": "",
    "x": 90,
    "y": 256,
    "vx": 1.5401576362987486,
    "vy": 0.2816418526546369,
    "color": "hsl(242.9837189379277, 100%, 70%)",
    "textColor": "white",
    "radius": 44,
    "font": "Arial",
    "image": "images/l20.png"
  },
  {
    "title": "",
    "description": "",
    "x": 1166.562621309401,
    "y": 793.0408709214169,
    "vx": -2.497339493414012,
    "vy": -0.3147238715038576,
    "color": "hsl(224.20161810948503, 100%, 70%)",
    "textColor": "white",
    "radius": 30,
    "font": "Arial",
    "image": "images/l9.png",
    "glow": false
  },
  {
    "title": "",
    "description": "",
    "x": 1687.5487539851497,
    "y": 889.8141235363323,
    "vx": -2.175313142075999,
    "vy": -0.16139345760507906,
    "color": "hsl(23.65478573148824, 100%, 70%)",
    "textColor": "white",
    "radius": 32,
    "font": "Arial",
    "image": "images/l10.png",
    "glow": true
  },
  {
    "title": "",
    "description": "",
    "x": 1186.0302510346844,
    "y": 879.4978900047323,
    "vx": 0.957133831701696,
    "vy": -0.7355857611214753,
    "color": "hsl(78.45499126148599, 100%, 70%)",
    "textColor": "white",
    "radius": 29,
    "font": "Arial",
    "image": "images/l11.png"
  }
],
        bg: "images/argyle1.png"
      },
      blank: {
        ideas: [],
        bg: "images/blank1.png"
      },
     meme: {
        ideas: [
    {
      title: "ğŸ’š",
      description: "Playoff Push",
      x: 1604.1220264398876,
      y: 774.6661552027556,
      vx: -2.9307834264879746,
      vy: -1.3209971258748892,
      color: "purple",
      textColor: "yellow",
      radius: 85,
      font: "Arial"
    },
    {
      title: "Meme",
      description: "",
      x: 1143.661675666017,
      y: 448,
      vx: 1.5,
      vy: 1,
      color: "hsl(273.35957733845265, 100%, 70%)",
      textColor: "white",
      radius: 100,
      font: "Arial"
    },
    {
      title: "",
      description: "",
      x: 520.8516322910205,
      y: 574.7903135181778,
      vx: 1.2034961795838606,
      vy: -1.5693732186467053,
      color: "hsl(52.914457387256874, 100%, 70%)",
      textColor: "black",
      radius: 80,
      font: "Arial"
    }
  ],
        bg: "images/meme1.png"
      },
foods:  {
        ideas: [],
        bg: "images/foods1.png"
      },
s25:  {
        ideas: [
          {
            "title": "S25 Video Player",
            "description": "Full-screen YouTube player with playlist",
            "x": 200,
            "y": 150,
            "vx": 0,
            "vy": 0,
            "color": "hsl(120, 100%, 70%)",
            "textColor": "white",
            "radius": 80,
            "font": "Arial",
            "glow": true
          },
          {
            "title": "Playlist Controls",
            "description": "Play, Pause, Next, Previous",
            "x": 400,
            "y": 250,
            "vx": 0,
            "vy": 0,
            "color": "hsl(240, 100%, 70%)",
            "textColor": "white",
            "radius": 70,
            "font": "Arial",
            "glow": true
          },
          {
            "title": "Video Playlist",
            "description": "Cycles through videos from s25_playlist.txt",
            "x": 600,
            "y": 350,
            "vx": -1.1,
            "vy": -2.1,
            "color": "hsl(60, 100%, 70%)",
            "textColor": "black",
            "radius": 65,
            "font": "Arial",
            "glow": true
          },
          {
            "title": "Emergency Controls",
            "description": "F3 key or ğŸš¨ button to force close",
            "x": 800,
            "y": 450,
            "vx": -1,
            "vy": -2,
            "color": "hsl(0, 100%, 70%)",
            "textColor": "white",
            "radius": 75,
            "font": "Arial",
            "glow": true
          }
        ],
        bg: "images/s251.png"
      },
sleep:  {
        ideas: [{
    "title": "",
    "description": "",
    "x": 659.1454361521289,
    "y": 605.1208426661004,
    "vx": -2.449121354884464,
    "vy": -1.092536594106302,
    "color": "hsl(8.228934602034869, 100%, 70%)",
    "textColor": "white",
    "radius": 60,
    "font": "Arial",
    "glow": false,
    "flash": false,
    "animateColors": false,
    "transparent": false,
    "glowColor": null,
    "fixed": false,
    "static": false,
    "image": "images/s12.png"
  },
  {
    "title": "",
    "description": "",
    "x": 1199.602107549329,
    "y": 585.3944712479614,
    "vx": 2.9618415239609845,
    "vy": -1.5018021914949107,
    "color": "hsl(307.2990522542704, 100%, 70%)",
    "textColor": "white",
    "radius": 68,
    "font": "Arial",
    "glow": false,
    "flash": false,
    "animateColors": false,
    "transparent": false,
    "glowColor": null,
    "fixed": false,
    "static": false,
    "image": "images/s8.png"
  },
  {
    "title": "",
    "description": "",
    "x": 1673.7868470884207,
    "y": 377.9763442565718,
    "vx": -2.6476805578233478,
    "vy": 0.023809805975364418,
    "color": "hsl(301.8790882076458, 100%, 70%)",
    "textColor": "white",
    "radius": 61,
    "font": "Arial",
    "glow": false,
    "flash": false,
    "animateColors": false,
    "transparent": false,
    "glowColor": null,
    "fixed": false,
    "static": false,
    "image": "images/s3.png"
  },
  {
    "title": "",
    "description": "",
    "x": 1375.8641447859266,
    "y": 228.37453009081958,
    "vx": 0.8106994812722605,
    "vy": 2.599250885024101,
    "color": "hsl(301.24705168705447, 100%, 70%)",
    "textColor": "white",
    "radius": 87,
    "font": "Arial",
    "glow": false,
    "flash": false,
    "animateColors": false,
    "transparent": false,
    "glowColor": null,
    "fixed": false,
    "static": false,
    "image": "images/s1.png"
  },
  {
    "title": "",
    "description": "",
    "x": 355.4868070464163,
    "y": 290.707211260573,
    "vx": 0.4174551897694838,
    "vy": 1.9937846695219978,
    "color": "hsl(137.0826811789322, 100%, 70%)",
    "textColor": "white",
    "radius": 83,
    "font": "Arial",
    "glow": false,
    "flash": false,
    "animateColors": false,
    "transparent": false,
    "glowColor": null,
    "fixed": false,
    "static": false,
    "image": "images/s5.png"
  }
],
        bg: "images/sleep1.png"
      },
credits:  {
        ideas: [{
    "title": "Projects",
    "description": "",
    "x": 355.4868070464163,
    "y": 290.707211260573,
    "vx": 0.4174551897694838,
    "vy": 1.9937846695219978,
    "color": "hsl(137.0826811789322, 100%, 70%)",
    "textColor": "white",
    "radius": 76,
    "font": "Arial",
    "glow": false,
    "flash": false,
    "animateColors": false,
    "transparent": false,
    "glowColor": null,
    "fixed": false,
    "static": false,
    "image": "images/l12.png"
  }
],
        bg: "images/credits1.png"
      }
};

// Add back toolbar and theme variables
let toolbar = document.getElementById('toolbar');
let inactivityTimeout;

function showToolbar() {
  toolbar.style.opacity = "1";
  clearTimeout(inactivityTimeout);
  inactivityTimeout = setTimeout(() => {
    toolbar.style.opacity = "0";
  }, 5000); // 5 seconds
}

// Show on any mouse movement
document.addEventListener("mousemove", showToolbar);

// Initially call it so toolbar hides after 5s
showToolbar();

let currentTheme = "default";
let backgroundIndex = 1;

// S25 Player Variables and Functions
let s25Playlist = [];
let s25VideoTitles = []; // Store video titles
let s25CurrentIndex = 0;
let s25IsPlaying = false;
let s25PlaylistVisible = false;
let s25ControlsTimeout = null;
let s25PlaylistTimeout = null;
let s25PlayerMode = 'fullscreen'; // 'fullscreen' or 'centered'

// Load S25 playlist from file
async function loadS25Playlist() {
  try {
    console.log('ğŸ“‹ S25 Loading playlist from s25_playlist.txt...');
    const response = await fetch('s25_playlist.txt');
    console.log('ğŸ“‹ S25 Response status:', response.status);
    console.log('ğŸ“‹ S25 Response ok:', response.ok);
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const text = await response.text();
    console.log('ğŸ“‹ S25 Raw text (first 200 chars):', text.substring(0, 200));
    
    // Filter out empty lines and HTML content
    s25Playlist = text.split('\n')
      .filter(line => line.trim() !== '')
      .filter(line => line.includes('youtube.com/watch'))
      .map(line => line.trim());
    
    console.log('ğŸ“‹ S25 Filtered playlist:', s25Playlist);
    console.log('ğŸ“‹ S25 Playlist loaded:', s25Playlist.length, 'videos');
    
    if (s25Playlist.length === 0) {
      throw new Error('No valid YouTube URLs found in playlist');
    }
    
    // Fetch video titles
    s25VideoTitles = [];
    for (let i = 0; i < s25Playlist.length; i++) {
      const videoId = extractYouTubeId(s25Playlist[i]);
      if (videoId) {
        const title = await fetchVideoTitle(videoId);
        s25VideoTitles[i] = title || `Video ${i + 1}`;
      } else {
        s25VideoTitles[i] = `Video ${i + 1}`;
      }
    }
    
    console.log('ğŸ“‹ S25 Video titles loaded:', s25VideoTitles);
    updateS25PlaylistDisplay();
  } catch (error) {
    console.error('âŒ Error loading S25 playlist:', error);
    // Fallback to default playlist
    s25Playlist = [
      'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
      'https://www.youtube.com/watch?v=9bZkp7q19f0',
      'https://www.youtube.com/watch?v=kJQP7kiw5Fk'
    ];
    console.log('ğŸ“‹ S25 Using fallback playlist:', s25Playlist);
    updateS25PlaylistDisplay();
  }
}

function updateS25PlaylistDisplay() {
  const playlistContainer = document.getElementById('s25PlaylistItems');
  if (!playlistContainer) {
    console.error('âŒ S25 Playlist container not found');
    return;
  }
  
  console.log('ğŸ“‹ S25 Updating playlist display with', s25Playlist.length, 'videos');
  playlistContainer.innerHTML = '';
  
  s25Playlist.forEach((url, index) => {
    const item = document.createElement('div');
    item.className = 'playlist-item';
    
    // Use video title if available, otherwise fall back to ID
    const videoId = extractYouTubeId(url);
    const title = s25VideoTitles[index] || `Video ${index + 1}`;
    const displayText = videoId ? `${title} (${videoId})` : `${title} (Invalid URL)`;
    item.textContent = displayText;
    
    item.onclick = () => {
      console.log('ğŸ“‹ S25 Clicked playlist item:', index, 'Title:', title, 'URL:', url);
      s25PlayVideo(index);
      showS25Playlist(); // Show playlist when clicking
    };
    
    if (index === s25CurrentIndex) {
      item.classList.add('playing');
    }
    playlistContainer.appendChild(item);
  });
  
  console.log('ğŸ“‹ S25 Playlist display updated');
}

function s25PlayVideo(index) {
  if (index < 0 || index >= s25Playlist.length) return;
  
  s25CurrentIndex = index;
  const url = s25Playlist[index];
  const videoId = extractYouTubeId(url);
  
  if (videoId) {
    const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=0&controls=1&loop=0`;
    const s25Iframe = document.getElementById('s25Iframe');
    if (s25Iframe) {
      s25Iframe.src = embedUrl;
      s25IsPlaying = true;
      updateS25PlaylistDisplay();
      console.log('ğŸµ S25 Playing video:', index + 1, 'of', s25Playlist.length, 'Video ID:', videoId);
    }
  } else {
    console.error('âŒ Invalid YouTube URL:', url);
  }
}

function extractYouTubeId(url) {
  // Handle various YouTube URL formats
  const patterns = [
    /(?:youtube\.com\/watch\?v=|youtu\.be\/)([^\s&?]+)/,
    /youtube\.com\/embed\/([^\s&?]+)/,
    /youtube\.com\/v\/([^\s&?]+)/
  ];
  
  for (const pattern of patterns) {
    const match = url.match(pattern);
    if (match) {
      return match[1];
    }
  }
  
  console.error('âŒ Could not extract YouTube ID from URL:', url);
  return null;
}

async function fetchVideoTitle(videoId) {
  try {
    // Use YouTube oEmbed API to get video title
    const response = await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`);
    if (response.ok) {
      const data = await response.json();
      return data.title;
    }
  } catch (error) {
    console.error('âŒ Error fetching video title for', videoId, ':', error);
  }
  return null;
}

function s25Play() {
  if (s25Playlist.length > 0) {
    s25PlayVideo(s25CurrentIndex);
    showS25Controls();
    console.log('â–¶ï¸ S25 Play requested for video:', s25CurrentIndex + 1);
  } else {
    console.log('âŒ No videos in playlist');
  }
}

function s25Pause() {
  // YouTube iframe doesn't support pause via JavaScript
  // This would require YouTube API integration
  console.log('â¸ï¸ S25 Pause requested (requires YouTube API)');
  showS25Controls();
}

function s25Next() {
  if (s25Playlist.length > 0) {
    s25CurrentIndex = (s25CurrentIndex + 1) % s25Playlist.length;
    s25PlayVideo(s25CurrentIndex);
    showS25Controls();
    console.log('â­ï¸ S25 Next video:', s25CurrentIndex + 1);
  } else {
    console.log('âŒ No videos in playlist');
  }
}

function s25Prev() {
  if (s25Playlist.length > 0) {
    s25CurrentIndex = s25CurrentIndex === 0 ? s25Playlist.length - 1 : s25CurrentIndex - 1;
    s25PlayVideo(s25CurrentIndex);
    showS25Controls();
    console.log('â®ï¸ S25 Previous video:', s25CurrentIndex + 1);
  } else {
    console.log('âŒ No videos in playlist');
  }
}

function s25TogglePlaylist() {
  const playlist = document.getElementById('s25Playlist');
  s25PlaylistVisible = !s25PlaylistVisible;
  
  if (s25PlaylistVisible) {
    playlist.style.display = 'block';
    playlist.style.opacity = '1';
    startS25PlaylistFadeOut();
    console.log('ğŸ“‹ S25 playlist shown');
  } else {
    playlist.style.display = 'none';
    playlist.style.opacity = '1'; // Reset opacity
    if (s25PlaylistTimeout) {
      clearTimeout(s25PlaylistTimeout);
      s25PlaylistTimeout = null;
    }
    console.log('ğŸ“‹ S25 playlist hidden');
  }
}

function startS25ControlsFadeOut() {
  // Clear existing timeout
  if (s25ControlsTimeout) {
    clearTimeout(s25ControlsTimeout);
  }
  
  // Set new timeout for 10 seconds
  s25ControlsTimeout = setTimeout(() => {
    const s25Controls = document.getElementById('s25Controls');
    if (s25Controls && s25Controls.style.display !== 'none') {
      s25Controls.style.opacity = '0';
      console.log('â° S25 controls faded out');
    }
  }, 10000);
}

function startS25PlaylistFadeOut() {
  // Clear existing timeout
  if (s25PlaylistTimeout) {
    clearTimeout(s25PlaylistTimeout);
  }
  
  // Set new timeout for 10 seconds
  s25PlaylistTimeout = setTimeout(() => {
    const s25Playlist = document.getElementById('s25Playlist');
    if (s25Playlist && s25Playlist.style.display !== 'none') {
      s25Playlist.style.opacity = '0';
      console.log('â° S25 playlist faded out');
    }
  }, 10000);
}

function showS25Controls() {
  const s25Controls = document.getElementById('s25Controls');
  if (s25Controls) {
    s25Controls.style.opacity = '1';
    // Restart fade-out timer
    startS25ControlsFadeOut();
  }
}

function showS25Playlist() {
  const s25Playlist = document.getElementById('s25Playlist');
  if (s25Playlist) {
    s25Playlist.style.opacity = '1';
    // Restart fade-out timer
    startS25PlaylistFadeOut();
  }
}

function s25Close() {
  console.log('ğŸ”’ S25 Close called');
  const s25Player = document.getElementById('s25Player');
  const s25Controls = document.getElementById('s25Controls');
  const s25Playlist = document.getElementById('s25Playlist');
  const s25Iframe = document.getElementById('s25Iframe');
  
  // Clear fade-out timers
  if (s25ControlsTimeout) {
    clearTimeout(s25ControlsTimeout);
    s25ControlsTimeout = null;
  }
  if (s25PlaylistTimeout) {
    clearTimeout(s25PlaylistTimeout);
    s25PlaylistTimeout = null;
  }
  
  if (s25Player) {
    s25Player.style.display = 'none';
    s25Player.style.pointerEvents = 'none';
    s25Player.className = ''; // Reset classes
  }
  if (s25Controls) {
    s25Controls.style.display = 'none';
    s25Controls.style.pointerEvents = 'none';
    s25Controls.style.opacity = '1'; // Reset opacity
  }
  if (s25Playlist) {
    s25Playlist.style.display = 'none';
    s25Playlist.style.pointerEvents = 'none';
    s25Playlist.style.opacity = '1'; // Reset opacity
  }
  if (s25Iframe) {
    s25Iframe.src = '';
    s25Iframe.style.display = 'none';
  }
  
  s25IsPlaying = false;
  s25PlaylistVisible = false;
  s25PlayerMode = 'fullscreen'; // Reset mode
  console.log('âœ… S25 player closed');
}

function s25ToggleFullscreen() {
  const s25Player = document.getElementById('s25Player');
  if (!s25Player) return;
  
  if (s25PlayerMode === 'fullscreen') {
    // Switch to centered mode
    s25Player.className = 'centered';
    s25PlayerMode = 'centered';
    console.log('ğŸ“º S25 player switched to centered mode');
  } else {
    // Switch to fullscreen mode
    s25Player.className = 'fullscreen';
    s25PlayerMode = 'fullscreen';
    console.log('ğŸ–¥ï¸ S25 player switched to fullscreen mode');
  }
  
  // Show controls when toggling
  showS25Controls();
}

// Force close function for emergency use
function forceCloseS25() {
  console.log('ğŸš¨ Force closing S25');
  const elements = ['s25Player', 's25Controls', 's25Playlist', 's25Iframe'];
  elements.forEach(id => {
    const element = document.getElementById(id);
    if (element) {
      element.style.display = 'none';
      element.style.pointerEvents = 'none';
      element.style.zIndex = '-1';
    }
  });
  s25IsPlaying = false;
  s25PlaylistVisible = false;
}

// Toggle S25 player function
function toggleS25Player() {
  console.log('ğŸŸï¸ Toggle S25 player');
  
  // Switch to S25 theme first
  const themeSelector = document.getElementById('themeSelector');
  if (themeSelector && themeSelector.value !== 's25') {
    themeSelector.value = 's25';
    switchTheme('s25');
  }
  
  const s25Player = document.getElementById('s25Player');
  if (s25Player) {
    if (s25Player.style.display === 'none' || s25Player.style.display === '') {
      // Show player
      s25Player.style.display = 'block';
      s25Player.style.pointerEvents = 'auto';
      s25Player.className = 'fullscreen';
      s25PlayerMode = 'fullscreen';
      
      // Show controls
      const s25Controls = document.getElementById('s25Controls');
      if (s25Controls) {
        s25Controls.style.display = 'block';
        s25Controls.style.pointerEvents = 'auto';
        s25Controls.style.opacity = '1';
      }
      
      // Load playlist if not loaded
      if (s25Playlist.length === 0) {
        loadS25Playlist();
      }
      
      // Start first video
      if (s25Playlist.length > 0) {
        s25PlayVideo(0);
      }
      
      startS25ControlsFadeOut();
      console.log('ğŸŸï¸ S25 player opened');
    } else {
      // Hide player
      s25Close();
      console.log('ğŸŸï¸ S25 player closed');
    }
  }
}

    function switchTheme(themeName) {
      console.log('ğŸ¨ Switching theme to:', themeName);
      currentTheme = themeName;
      backgroundIndex = 1;
      
      // Hide S25 player if switching away from S25 theme
      if (currentTheme !== 's25') {
        console.log('ğŸ”’ Closing S25 player');
        if (typeof s25Close === 'function') {
          s25Close();
        } else {
          console.warn('âš ï¸ s25Close function not available');
        }
      }
      
      const theme = themePresets[themeName];
      if (!theme) {
        console.error('âŒ Theme not found:', themeName);
        return;
      }
      
      console.log('ğŸ“‹ Loading theme ideas:', theme.ideas.length);
      
      // Load theme-specific ideas for all themes
      ideas = theme.ideas.map(idea => ({
        ...idea,
        font: idea.font || fonts[0],
        radius: idea.radius || 80
      }));

      const img = new Image();
      img.onload = function () {
        backgroundImage = img;
        console.log('ğŸ–¼ï¸ Background image loaded:', themeName);
      };
      img.onerror = function() {
        console.error('âŒ Failed to load background image:', themeName);
      };
      img.src = `images/${themeName}1.png`;
      
      // Handle S25 theme specifically
      if (themeName === 's25') {
        console.log('ğŸµ Activating S25 theme');
        const s25Player = document.getElementById('s25Player');
        const s25Controls = document.getElementById('s25Controls');
        const s25Iframe = document.getElementById('s25Iframe');
        
        if (s25Player && s25Controls && s25Iframe) {
          // Reset player state for re-opening
          s25PlayerMode = 'fullscreen';
          s25Player.className = 'fullscreen';
          s25Player.style.display = 'block';
          s25Controls.style.display = 'block';
          s25Controls.style.opacity = '1';
          console.log('âœ… S25 player activated');
          
          // Set a default video if playlist loading fails
          const defaultVideoId = 'dQw4w9WgXcQ';
          const defaultEmbedUrl = `https://www.youtube.com/embed/${defaultVideoId}?autoplay=1&mute=0&controls=1&loop=0`;
          s25Iframe.src = defaultEmbedUrl;
          console.log('ğŸµ Set default video:', defaultVideoId);
          
          // Start controls fade-out timer
          startS25ControlsFadeOut();
          
          if (typeof loadS25Playlist === 'function') {
            loadS25Playlist().then(() => {
              if (s25Playlist && s25Playlist.length > 0 && typeof s25PlayVideo === 'function') {
                s25PlayVideo(0);
              }
            }).catch(error => {
              console.error('Error loading S25 playlist:', error);
            });
          } else {
            console.error('âŒ loadS25Playlist function not available');
          }
        } else {
          console.error('âŒ S25 player elements not found:', {
            s25Player: !!s25Player,
            s25Controls: !!s25Controls,
            s25Iframe: !!s25Iframe
          });
        }
      }
    }

    function cycleBackground() {
      backgroundIndex += 1;
      const img = new Image();
      img.onload = function () {
        backgroundImage = img;
      };
      img.onerror = function () {
        backgroundIndex = 1;
        img.src = `images/${currentTheme}1.png`;
      };
      img.src = `images/${currentTheme}${backgroundIndex}.png`;
    }
    let gamepadIndex = null;
let gamepadActive = false;
let gamepadLoopId = null;

window.addEventListener("gamepadconnected", (e) => {
  gamepadIndex = e.gamepad.index;
  gamepadActive = true;
  console.log("ğŸ® Gamepad connected");
  gamepadLoop();
});

window.addEventListener("gamepaddisconnected", () => {
  gamepadActive = false;
  console.log("âŒ Gamepad disconnected");
  cancelAnimationFrame(gamepadLoopId);
});

function gamepadLoop() {
  const gp = navigator.getGamepads()[gamepadIndex];
  if (!gp) return;

  // Select next idea with Button A (index 0)
  if (gp.buttons[0].pressed && ideas.length > 0) {
    const currentIndex = selectedIdea ? ideas.indexOf(selectedIdea) : -1;
    const nextIndex = (currentIndex + 1) % ideas.length;
    selectedIdea = ideas[nextIndex];
    showPanel();
    console.log("ğŸ® Gamepad: Selected idea", nextIndex + 1, "of", ideas.length);
  }

  // Move selected idea with left stick (axes 0 and 1)
  if (selectedIdea && panel.style.display === "none") {
    const dx = gp.axes[0]; // X-axis
    const dy = gp.axes[1]; // Y-axis
    const speed = 5;
    
    // Only move if stick is moved significantly (deadzone)
    if (Math.abs(dx) > 0.1 || Math.abs(dy) > 0.1) {
      selectedIdea.x += dx * speed;
      selectedIdea.y += dy * speed;
      console.log("ğŸ® Gamepad: Moving idea to", selectedIdea.x.toFixed(1), selectedIdea.y.toFixed(1));
    }
  }

  gamepadLoopId = requestAnimationFrame(gamepadLoop);
}

document.addEventListener('keydown', function(event) {
  // F1 = cycle background
  if (event.key === 'F1') {
    event.preventDefault();
    cycleBackground();
    console.log("âŒ¨ï¸ Keyboard: F1 pressed - cycling background");
  }

  // F2 = toggle motion
  if (event.key === 'F2') {
    event.preventDefault();
    speedMultiplier = speedMultiplier > 0 ? 0 : 1;
    console.log("âŒ¨ï¸ Keyboard: F2 pressed - motion", speedMultiplier > 0 ? "ON" : "OFF");
  }
  
  // F3 = force close S25 player
  if (event.key === 'F3') {
    event.preventDefault();
    forceCloseS25();
    console.log("âŒ¨ï¸ Keyboard: F3 pressed - force close S25");
  }
  
  // Arrow keys for moving selected idea
  if (selectedIdea && panel.style.display === "none") {
    const moveSpeed = 10;
    switch(event.key) {
      case 'ArrowUp':
        event.preventDefault();
        selectedIdea.y -= moveSpeed;
        break;
      case 'ArrowDown':
        event.preventDefault();
        selectedIdea.y += moveSpeed;
        break;
      case 'ArrowLeft':
        event.preventDefault();
        selectedIdea.x -= moveSpeed;
        break;
      case 'ArrowRight':
        event.preventDefault();
        selectedIdea.x += moveSpeed;
        break;
    }
  }
});




const loadedImages = {};
let imageLoadErrors = new Set(); // Track failed images to prevent infinite retries
let recordedStates = { start: [], end: [] };
let isPlaying = false;
let isFrozen = false;
let playbackT = 0;

function deepCopyIdeas() {
  return ideas.map(i => ({ ...i }));
}

function recordState(type) {
  recordedStates[type] = deepCopyIdeas();
  console.log(`State '${type}' recorded.`);
  if (type === 'start') isFrozen = true;
}

function lerp(a, b, t) {
  return a + (b - a) * t;
}

function applyPlayback(t) {
  if (!recordedStates.start.length || !recordedStates.end.length) return;

  let start = recordedStates.start;
  let end = recordedStates.end;

  ideas = start.map((s, i) => {
    const e = end[i] || s;
    return {
      ...s,
      x: lerp(s.x, e.x, t),
      y: lerp(s.y, e.y, t),
      radius: lerp(s.radius, e.radius, t),
      color: s.color,
      textColor: s.textColor,
      font: s.font,
      title: s.title,
      description: s.description,
    };
  });
}

function startPlayback() {
  if (!recordedStates.start.length || !recordedStates.end.length) return;
  const duration = parseInt(document.getElementById('playbackDuration').value) || 10000;
  const startTime = performance.now();
  isPlaying = true;

  function stepPlayback(now) {
    let t = Math.min((now - startTime) / duration, 1);
    playbackT = t;
    applyPlayback(t);
    document.getElementById('playbackSlider').value = t;
    document.getElementById('mediaPlaybackSlider').value = t;
    if (t < 1 && isPlaying) {
      requestAnimationFrame(stepPlayback);
    } else {
      isPlaying = false;
    }
  }

  requestAnimationFrame(stepPlayback);
}

document.getElementById('playbackSlider').addEventListener('input', (e) => {
  isPlaying = false;
  const t = parseFloat(e.target.value);
  playbackT = t;
  applyPlayback(t);
  // Sync with media toolbar slider
  document.getElementById('mediaPlaybackSlider').value = t;
});

// Media toolbar playback controls
document.getElementById('mediaPlaybackSlider').addEventListener('input', (e) => {
  isPlaying = false;
  const t = parseFloat(e.target.value);
  playbackT = t;
  applyPlayback(t);
  // Sync with main playback slider
  document.getElementById('playbackSlider').value = t;
});

document.getElementById('playbackDuration').addEventListener('change', (e) => {
  const duration = parseInt(e.target.value);
  // Sync with media toolbar duration
  document.getElementById('mediaPlaybackDuration').value = duration;
});

document.getElementById('mediaPlaybackDuration').addEventListener('change', (e) => {
  const duration = parseInt(e.target.value);
  // Sync with main playback duration
  document.getElementById('playbackDuration').value = duration;
});

function rotateBackground() {
  backgroundRotation = (backgroundRotation + 90) % 360;
  console.log("ğŸ”„ Background rotated to:", backgroundRotation + "Â°");
}

function rollDice() {
  const result = Math.floor(Math.random() * 6) + 1;
  const diceOverlay = document.getElementById('diceOverlay');
  const diceResult = document.getElementById('diceResult');
  
  // Show the dice result in overlay
  diceOverlay.textContent = result;
  diceOverlay.style.display = 'block';
  
  // Show the dice result in toolbar
  diceResult.textContent = `ğŸ² ${result}`;
  
  console.log("ğŸ² Dice roll result:", result);
  
  // Hide overlay after 5 seconds
  setTimeout(() => {
    diceOverlay.style.display = 'none';
  }, 5000);
}

function toggleMusicPanel() {
  const musicPanel = document.getElementById('musicPanel');
  if (musicPanel.style.display === 'none' || musicPanel.style.display === '') {
    musicPanel.style.display = 'block';
    loadMusicList();
    
    // Auto-hide after 10 seconds
    setTimeout(() => {
      musicPanel.style.display = 'none';
    }, 10000);
  } else {
    musicPanel.style.display = 'none';
  }
}

function loadMusicList() {
  const musicList = document.getElementById('musicList');
  
  // Get actual MP3 files from the mp3 folder
  const musicFiles = [
    'mp3/track1.mp3',
    'mp3/Track1NGE.mp3',
    'mp3/Stereotype Anomaly - HEMPHILL (2025).mp3',
    'mp3/Track4D+B.opus',
    'mp3/Track4D+B.mp3',
    'mp3/track2.mp3',
    'mp3/track3.mp3',
    'mp3/track4.mp3',
    'mp3/track5.mp3',
    'mp3/track6.mp3',
    'mp3/track7.mp3',
    'mp3/track8.mp3'
  ];
  
  musicList.innerHTML = '';
  
  // Check browser audio support
  const audio = new Audio();
  const canPlayMp3 = audio.canPlayType('audio/mpeg');
  const canPlayOpus = audio.canPlayType('audio/opus');
  
  console.log('ğŸµ Browser audio support:');
  console.log('   MP3:', canPlayMp3);
  console.log('   OPUS:', canPlayOpus);
  
  musicFiles.forEach(file => {
    const musicItem = document.createElement('div');
    musicItem.className = 'music-item';
    
    // Show filename with format indicator
    const filename = file.split('/').pop();
    const isOpus = filename.toLowerCase().endsWith('.opus');
    const displayName = isOpus ? `${filename} ğŸµ` : filename;
    musicItem.textContent = displayName;
    
    // Add visual indicator for OPUS files
    if (isOpus) {
      musicItem.style.borderLeft = '3px solid #ff6b6b';
      musicItem.title = 'OPUS format - may not work in all browsers';
    }
    
    musicItem.onclick = (event) => playMusic(file, event);
    musicList.appendChild(musicItem);
  });
  
  // Add a note about audio formats
  const noteItem = document.createElement('div');
  noteItem.style.cssText = 'color: #888; font-style: italic; text-align: center; padding: 10px; font-size: 12px;';
  noteItem.innerHTML = `
    Supported formats: MP3 âœ…, OPUS ${canPlayOpus ? 'âœ…' : 'âš ï¸'}<br>
    Add more audio files to the mp3/ folder to see them here
  `;
  musicList.appendChild(noteItem);
}

function playMusic(filename, event) {
  // Remove playing class from all items
  document.querySelectorAll('.music-item').forEach(item => {
    item.classList.remove('playing');
  });

  // Add playing class to clicked item
  if (event && event.target) {
    event.target.classList.add('playing');
  }

  console.log(`ğŸµ Playing: ${filename}`);

  // Check if it's an OPUS file
  const isOpus = filename.toLowerCase().endsWith('.opus');
  
  if (isOpus) {
    console.log('ğŸµ OPUS file detected, checking browser support...');
    
    // Check if browser supports OPUS
    const audio = new Audio();
    const canPlayOpus = audio.canPlayType('audio/opus');
    
    if (canPlayOpus === 'probably' || canPlayOpus === 'maybe') {
      console.log('âœ… Browser supports OPUS natively');
    } else {
      console.warn('âš ï¸ Browser may not support OPUS natively, trying anyway...');
    }
  }

  // Create audio element and play
  const audio = new Audio(filename);
  audio.volume = 0.5; // Set volume to 50%

  // Stop any currently playing audio
  if (window.currentAudio) {
    window.currentAudio.pause();
    window.currentAudio = null;
  }

  window.currentAudio = audio;

  audio.play().then(() => {
    console.log(`ğŸµ Successfully started playing: ${filename}`);
  }).catch(err => {
    console.error(`âŒ Error playing audio: ${err}`);
    
    // If OPUS fails, try to provide helpful error message
    if (filename.toLowerCase().endsWith('.opus')) {
      console.error('âŒ OPUS playback failed. This might be due to:');
      console.error('   - Browser not supporting OPUS format');
      console.error('   - Missing OPUS codec');
      console.error('   - File corruption');
      console.error('   - CORS issues');
    }
    
    if (event && event.target) {
      event.target.classList.remove('playing');
    }
  });
}

function stopMusic() {
  // Stop any currently playing audio
  if (window.currentAudio) {
    window.currentAudio.pause();
    window.currentAudio = null;
    console.log("ğŸ”‡ Music stopped");
  }
  
  // Remove playing class from all items
  document.querySelectorAll('.music-item').forEach(item => {
    item.classList.remove('playing');
  });
}
function toggleMediaToolbar() {
  const bar = document.getElementById("mediaToolbar");
  if (bar) {
    const currentDisplay = bar.style.display || getComputedStyle(bar).display;
    bar.style.display = (currentDisplay === "none" || currentDisplay === "") ? "flex" : "none";
    console.log("ğŸ“º Media toolbar toggled:", bar.style.display);
  }
}

function captureCanvas() {
  const canvas = document.getElementById("canvas");
  if (!canvas) {
    console.error("Canvas not found");
    return;
  }
  
  // Ensure canvas is properly sized
  if (canvas.width === 0 || canvas.height === 0) {
    console.error("Canvas has zero dimensions");
    return;
  }
  
  console.log("Canvas dimensions:", canvas.width, "x", canvas.height);
  
  try {
    const dataURL = canvas.toDataURL("image/png");
    console.log("Data URL length:", dataURL.length);
    
    const link = document.createElement("a");
    link.download = "snapshot.png";
    link.href = dataURL.replace("image/png", "image/octet-stream");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    console.log("Snapshot download initiated");
  } catch (error) {
    console.error("Error capturing snapshot:", error);
  }
}

// Function to capture just the canvas area (for toolbar button)
function captureCanvasOnly() {
  const canvas = document.getElementById("canvas");
  if (!canvas) {
    console.error("Canvas not found");
    return;
  }
  
  // Ensure canvas is properly sized
  if (canvas.width === 0 || canvas.height === 0) {
    console.error("Canvas has zero dimensions");
    return;
  }
  
  console.log("Canvas dimensions:", canvas.width, "x", canvas.height);
  
  try {
    const dataURL = canvas.toDataURL("image/png");
    console.log("Data URL length:", dataURL.length);
    
    const link = document.createElement("a");
    link.download = "canvas_snapshot.png";
    link.href = dataURL.replace("image/png", "image/octet-stream");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    console.log("Canvas snapshot download initiated");
  } catch (error) {
    console.error("Error capturing canvas snapshot:", error);
  }
}

const imageInput = document.getElementById('bubbleImage');
const styleSelect = document.getElementById('styleSelect');

function applyToBubble(bubble) {
  const style = styleSelect.value;
  bubble.className = 'bubble';
  if (style) bubble.classList.add(style);

  imageInput.onchange = e => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(evt) {
        let img = bubble.querySelector('img');
        if (!img) {
          img = document.createElement('img');
          bubble.appendChild(img);
        }
        img.src = evt.target.result;
      };
      reader.readAsDataURL(file);
    }
  };
}






// Event listeners will be set up in DOMContentLoaded




let lastChangedDropdown = null;

// Add event listeners after DOM is ready
document.addEventListener('DOMContentLoaded', function() {
  console.log("ğŸ”„ DOMContentLoaded fired, setting up event listeners");
  
  // Set up image selector
  const imageSelector = document.getElementById('imageSelector');
  console.log("ğŸ–¼ï¸ imageSelector found:", !!imageSelector);
  if (imageSelector) {
    imageSelector.addEventListener('change', (e) => {
      console.log("ğŸ–¼ï¸ Dropdown changed, selectedIdea:", selectedIdea ? selectedIdea.title : "none");
      if (selectedIdea) {
        const value = e.target.value || null;
        selectedIdea.image = value;
        console.log("ğŸ–¼ï¸ Selected from dropdown:", value || "none");
        console.log("ğŸ–¼ï¸ Bubble title:", selectedIdea.title);
        
        // If "None" is selected, ensure bubble has a random color
        if (!value || value === "") {
          if (!selectedIdea.color || selectedIdea.color === "black") {
            selectedIdea.color = randomColor();
            console.log("ğŸ¨ Reset color to:", selectedIdea.color);
          }
        }
        
        // Preload the image if it's not already loaded
        if (value && !loadedImages[value]) {
          console.log("ğŸ”„ Loading dropdown image:", value);
          const img = new Image();
          img.crossOrigin = "anonymous";
          img.onload = () => {
            loadedImages[value] = img;
            console.log("ğŸ–¼ï¸ Dropdown image loaded successfully:", value);
            console.log("ğŸ–¼ï¸ Image dimensions:", img.width, "x", img.height);
            console.log("ğŸ–¼ï¸ Total loaded images:", Object.keys(loadedImages).length);
          };
          img.onerror = () => {
            console.error("âŒ Failed to load dropdown image:", value);
            selectedIdea.image = null;
            delete loadedImages[value];
          };
          img.src = value;
        } else if (value && loadedImages[value]) {
          console.log("ğŸ–¼ï¸ Dropdown image already loaded:", value);
          console.log("ğŸ–¼ï¸ Image dimensions:", loadedImages[value].width, "x", loadedImages[value].height);
        }
      } else {
        console.log("âŒ No selectedIdea when dropdown changed");
      }
    });
  }
  
  // Effect toggle listeners are now handled by button onclick functions
  
  // Add panel interaction listeners to reset fade timer
  const panel = document.getElementById('panel');
  if (panel) {
    panel.addEventListener('mousemove', resetPanelTimer);
    panel.addEventListener('click', resetPanelTimer);
    panel.addEventListener('input', resetPanelTimer);
    panel.addEventListener('change', resetPanelTimer);
  }
   
});
</script>
</body>
</html>
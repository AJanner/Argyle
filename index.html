<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <link href="favicon.ico" rel="icon" type="image/x-icon"/>
  <title>ğŸ’­MindsEyeğŸ’¬~Ideas</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <!-- Toolbar -->
  <div id="toolbar">
    <button onclick="toggleMediaToolbar()" title="Media Toolbar">ğŸ›ï¸</button>
    <button onclick="captureCanvasOnly()" title="Snapshot">ğŸ“·</button>
    <button onclick="rollDice()" oncontextmenu="showDiceSlider(); return false;" title="Random (Right-click for slider)">ğŸ²</button>
    <span id="diceResult" style="color: gold; margin: 0 15px; font-weight: bold;"></span>
    <button onclick="toggleMusicPanel()" title="Music Panel">ğŸ¶</button>
    <button onclick="location.reload()" title="Reset">â“‡</button>
    <button onclick="rotateBackground()" style="margin-left:10px;" title="Rotate Background">ğŸ”ƒ</button>
    <button onclick="cycleBackground()" style="margin-left:10px;" title="Change Background">ğŸ”„</button>
    
    <div>
      <strong style="font-size: 0.5em;">ğŸ¤”ğŸ’­MEğŸ’¬v4ğŸ˜</strong>
      <br>
      â¡ï¸ 
      <select id="themeSelector" onchange="switchTheme(this.value)" title="Select Use">
        <option value="default">Start ğŸ˜€</option>
        <option value="argyle">Argyle â™»ï¸</option>
        <option value="games">Games ğŸ®</option>
        <option value="blank">Blank ğŸ˜¶</option>
        <option value="meme">Memes ğŸ™„</option>
        <option value="foods">Food ğŸ˜‹</option>
        <option value="sleep">ğŸ¥± ğŸ˜´</option>
        <option value="credits"> ğŸ’š</option>
      </select>
      
      <select id="presetSelector" onchange="switchPreset(this.value)" title="Select Preset" style="margin-left: 1px;">
        <option value="">ğŸ˜‡ Preset</option>
      </select>
      <label style="margin-left: 1px;" title="Motion (Right-click to pause/unpause)"> 
        â¬…ï¸
        <button onclick="togglePauseButton()" style="margin: 0 5px; padding: 2px 6px; font-size: 12px;" title="Pause/Unpause">â¯ï¸</button>
        <input max="3" min="0.0" onchange="const slider = this; if(parseFloat(slider.value) !== 0) { previousSpeed = parseFloat(slider.value); slider.classList.remove('paused'); } else { slider.classList.add('paused'); } speedMultiplier = parseFloat(slider.value)" oncontextmenu="toggleSpeed(); return false;" step="0.1" type="range" value="1"/>
      </label>
    </div>
    
    <button onclick="saveIdeas()" title="Save .json File">ğŸ’¾Save.json</button>
    <input accept=".json" id="fileLoader" style="display:none" type="file"/>
    <button onclick="document.getElementById('fileLoader').click()" title="Load .json File">ğŸ†™ Load.json</button>
    <button onclick="deleteAllIdeas()" style="margin-left:0px;" title="Blank Canvas">ğŸš®ClearğŸ’­IdeasğŸ—‘ï¸</button>
    <button onclick="toggleVideoPlayer()" style="margin-left:10px;" title="Toggle Video Player">ğŸ“¹</button>
  </div>

  <!-- Media Toolbar -->
  <div id="mediaToolbar">
    <label>ğŸ«Ÿ Background:
      <input accept="image/*" id="bgLoader" type="file"/>
    </label>
    <label>ğŸ“€ Video:
      <input accept="video/*" id="videoLoader" type="file"/>
    </label>
    <label>ğŸ¥ YouTube:
      <input id="youtubeLink" placeholder="Paste Video URL" type="text"/>
      <button onclick="loadYouTubeVideo()">Load</button>
    </label>
    <div class="media-separator"></div>
    <button onclick="recordState('start')" class="record-btn start-btn" title="Mark In Point">ğŸ¬ In</button>
    <button onclick="recordState('end')" class="record-btn end-btn" title="Mark Out Point">ğŸ Out</button>
    <button onclick="startPlayback()" class="play-btn" title="Play In to Out">â–¶ï¸ Play</button>
    <div class="timeline-control">
      <span>Timeline:</span>
      <input id="mediaPlaybackSlider" max="1" min="0" step="0.01" type="range" value="0"/>
    </div>
    <div class="duration-control">
      <span>Duration:</span>
      <select id="mediaPlaybackDuration">
        <option value="5000">5s</option>
        <option selected="" value="10000">10s</option>
        <option value="15000">15s</option>
        <option value="20000">20s</option>
        <option value="30000">30s</option>
      </select>
    </div>
    <button onclick="captureCanvas()" class="snapshot-btn" title="Snapshot">ğŸ“· Snapshot</button>
  </div>

  <!-- Video Elements -->
  <video autoplay="" id="bgVideo" loop="" muted="" playsinline="" style="position:fixed; top:0; left:0; width:100vw; height:100vh; object-fit:cover; z-index:-2; display:none; pointer-events: none;"></video>
  <iframe allow="autoplay" allowfullscreen="" frameborder="0" id="ytFrame" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:-3; display:none;"></iframe>

  <!-- Video Player -->
  <div id="videoPlayer" onmouseenter="showVideoControls()">
    <iframe id="videoIframe" allow="autoplay" allowfullscreen="" frameborder="0"></iframe>
  </div>

  <!-- Video Controls -->
  <div id="videoControls">
    <div style="margin-bottom: 10px;">
      <label style="color: white; font-size: 12px;">Opacity: 
        <input type="range" id="videoOpacitySlider" min="0.0" max="1.0" step="0.1" value="0.5" style="width: 100px; margin-left: 5px;" oninput="updateVideoOpacity(this.value)"/>
      </label>
      <label style="color: white; font-size: 12px; margin-left: 10px;">Size: 
        <input type="range" id="videoSizeSlider" min="0.3" max="1.5" step="0.1" value="1.0" style="width: 100px; margin-left: 5px;" oninput="updateVideoSize(this.value)"/>
      </label>
    </div>
    <button onclick="videoPrev()" title="Previous" class="video-control-btn" data-icon="prev">â®ï¸</button>
    <button onclick="videoTogglePlay()" title="Play/Pause" class="video-control-btn" data-icon="play">ğŸŸ¢</button>

    <button onclick="videoNext()" title="Next" class="video-control-btn" data-icon="next">â­ï¸</button>
    <button onclick="videoTogglePlaylist()" title="Show Playlist" class="video-control-btn" data-icon="playlist">ğŸ“‹</button>
    <button onclick="videoToggleFullscreen()" title="Fullscreen" class="video-control-btn" data-icon="fullscreen">ğŸ–¥ï¸</button>
    <button onclick="videoClose()" title="Close" class="video-control-btn" data-icon="close">ï¿½ï¿½</button>
  </div>

  <!-- Video Playlist Panel -->
  <div id="videoPlaylist">
    <div style="position: relative;">
      <h3>ğŸ’š YouTube Playlist â™»ï¸</h3>
      <button onclick="minimizePlaylist()" title="Minimize" style="position: absolute; top: 5px; right: 30px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 3px; padding: 2px 6px; cursor: pointer; font-size: 10px;">âˆ’</button>
      <button onclick="closePlaylist()" title="Close" style="position: absolute; top: 5px; right: 5px; background: rgba(255,0,0,0.7); color: white; border: none; border-radius: 3px; padding: 2px 6px; cursor: pointer; font-size: 10px;">âœ•</button>
    </div>
    <div style="margin-bottom: 10px; padding: 10px; background: rgba(0, 0, 0, 0.3); border-radius: 5px;">
      <label style="display: block; margin-bottom: 5px; color: gold;">ğŸ“‹ Upload Playlist (.txt):</label>
      <input type="file" id="playlistUpload" accept=".txt" style="width: 100%; margin-bottom: 5px;"/>
      <button onclick="uploadPlaylist()" style="background: linear-gradient(45deg, #4CAF50, #45a049); border: none; color: black; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 12px;">ğŸ“¤ Upload</button>
      <button onclick="cyclePlaylists()" style="background: linear-gradient(45deg, #2196F3, #1976D2); border: none; color: black; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 12px; margin-left: 5px;">ğŸ”„ Cycle</button>
    </div>
    <div id="videoPlaylistItems">
      <!-- Playlist items will be loaded here -->
    </div>
  </div>

  <!-- Dice Overlay -->
  <div class="dice-overlay" id="diceOverlay"></div>

  <!-- Canvas -->
  <canvas id="canvas"></canvas>

  <!-- Music Panel -->
  <div class="music-panel" id="musicPanel">
    <h3>ğŸµ Music Player</h3>
    <div id="musicList">
      <!-- Music items will be loaded here -->
    </div>
    <button onclick="stopMusic()" style="background: linear-gradient(45deg, #f44336, #da190b); border: none; color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 10px; width: 100%;">â¯ï¸PlayğŸšï¸</button>
  </div>

  <!-- Main Panel -->
  <div class="panel" id="panel">
    <div style="position: relative; margin-bottom: 10px;">
      <div class="panel-close-btn" onclick="closePanel()" title="Close Panel">âœ•</div>
      <button onclick="minimizePanel()" title="Minimize" style="position: absolute; top: 8px; right: 35px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 3px; padding: 2px 6px; cursor: pointer; font-size: 10px;">ğŸ“‹</button>
    </div>
    <input id="title" placeholder="Title"/>
    <textarea id="description" placeholder="Description" rows="5"></textarea>
    <div class="resize-handle">â¤¡</div>
    
    <div style="margin-top: 1px;">
      <input accept="image/*" id="uploadImage" type="file"/>
    </div>
    
    <label style="margin-left: 10px;">â¬†ï¸ Upload PNG | â¬‡ï¸ Change ğŸ’­ Size
      <input id="sizeSlider" title="Bubble Size" max="200" min="10" oninput="selectedIdea.radius = parseInt(this.value)" type="range" value="75"/>
    </label><br>
    
    <label style="margin-left: 10px;">â¬‡ï¸ Text Size<br>
      <input id="fontSizeSlider" title="Text Size" max="48" min="8" oninput="selectedIdea.fontSize = parseInt(this.value)" type="range" value="14"/>
    </label>
    
    <input id="rotationSlider" title="Rotate Bubble" max="360" min="0" oninput="selectedIdea.rotation = parseInt(this.value)" type="range" value="0"/>
    
    <div style="margin-bottom: 10px;">
      <label style="margin-left: 10px;">â¬†ï¸ Rotation | â¬‡ï¸ Select Image ğŸ‘¾
        <select id="imageSelector" style="background-color: rgba(0, 0, 0, 0.6); color: gold; border: 2px solid darkgreen; font-family: 'Monaco', serif; padding: 6px; border-radius: 6px; width: 100%; margin-top: 5px;">
          <option value="">None</option>
          <option value="images/a1.png">a1.png</option>
          <option value="images/a2.png">a2.png</option>
          <option value="images/a3.png">a3.png</option>
          <option value="images/a4.png">a4.png</option>
          <option value="images/a5.png">a5.png</option>
          <option value="images/a6.png">a6.png</option>
          <option value="images/a7.png">a7.png</option>
          <option value="images/a8.png">a8.png</option>
          <option value="images/a9.png">a9.png</option>
          <option value="images/a10.png">a10.png</option>
          <option value="images/a11.png">a11.png</option>
          <option value="images/a12.png">a12.png</option>
          <option value="images/a13.png">a13.png</option>
          <option value="images/a14.png">a14.png</option>
          <option value="images/a15.png">a15.png</option>
          <option value="images/a16.png">a16.png</option>
          <option value="images/a17.png">a17.png</option>
          <option value="images/a18.png">a18.png</option>
          <option value="images/a19.png">a19.png</option>
          <option value="images/a20.png">a20.png</option>
          <option value="images/a21.png">a21.png</option>
          <option value="images/a22.png">a22.png</option>
          <option value="images/a23.png">a23.png</option>
          <option value="images/a24.png">a24.png</option>
          <option value="images/a25.png">a25.png</option>
          <option value="images/a26.png">a26.png</option>
          <option value="images/a27.png">a27.png</option>
          <option value="images/a28.png">a28.png</option>
          <option value="images/a29.png">a29.png</option>
          <option value="None">---â™»ï¸ArchiveğŸ’š---</option>
          <option value="images/l1.png">l1.png</option>
          <option value="images/l2.png">l2.png</option>
          <option value="images/l3.png">l3.png</option>
          <option value="images/l4.png">l4.png</option>
          <option value="images/l5.png">l5.png</option>
          <option value="images/l6.png">l6.png</option>
          <option value="images/l7.png">l7.png</option>
          <option value="images/l8.png">l8.png</option>
          <option value="images/l9.png">l9.png</option>
          <option value="images/l10.png">l10.png</option>
          <option value="images/l11.png">l11.png</option>
          <option value="images/l12.png">l12.png</option>
          <option value="images/l13.png">l13.png</option>
          <option value="images/l14.png">l14.png</option>
          <option value="images/l15.png">l15.png</option>
          <option value="images/l16.png">l16.png</option>
          <option value="images/l17.png">l17.png</option>
          <option value="images/l18.png">l18.png</option>
          <option value="images/l19.png">l19.png</option>
          <option value="images/l20.png">l20.png</option>
          <option value="images/l21.png">l21.png</option>
          <option value="images/l22.png">l22.png</option>
          <option value="images/l23.png">l23.png</option>
          <option value="images/l24.png">l24.png</option>
          <option value="images/l25.png">l25.png</option>
          <option value="images/l26.png">l26.png</option>
          <option value="images/l27.png">l27.png</option>
          <option value="images/l28.png">l28.png</option>
          <option value="images/l29.png">l29.png</option>
          <option value="images/l30.png">l30.png</option>
          <option value="images/l31.png">l31.png</option>
          <option value="images/l32.png">l32.png</option>
          <option value="images/l33.png">l33.png</option>
          <option value="images/l34.png">l34.png</option>
          <option value="images/l35.png">l35.png</option>
          <option value="images/l36.png">l36.png</option>
          <option value="images/l37.png">l37.png</option>
          <option value="images/l38.png">l38.png</option>
          <option value="images/l39.png">l39.png</option>
          <option value="images/l40.png">l40.png</option>
        </select>
      </label>
    </div>
    
    <div style="margin-bottom: 10px;">
      <button onclick="toggleGlow()" title="Toggle Glow">GlowğŸ”†</button>
      <button onclick="changeGlowColor()" title="Change Glow Color">ColourğŸ”…</button>
      <button onclick="toggleFlash()" title="Toggle Flash">FlashğŸ‡</button>
      <button onclick="toggleAnimateColors()" title="Toggle Animate Colors">AllğŸ¨</button>
      <button onclick="toggleTransparent()" title="Toggle Transparent">Opaque</button>
      <button onclick="toggleFixed()" title="Toggle Fixed Mode">SolidğŸ—¿</button>
      <button onclick="toggleStatic()" title="Toggle Static Mode">StaticğŸ§½</button>
      <button onclick="togglePanelSide()" title="Toggle Panel Side">â†”ï¸</button>
      <button onclick="toggleCheckeredBorder()" title="Toggle Checkered Border">CheckğŸ</button>
    </div>
    
    <div style="margin-top: 10px;">
      <button onclick="savePanel()" title="Save">SaveğŸ’¾</button>
      <button onclick="changeColor()" title="Bubble Colour">ğŸ’­ï¸Colour</button>
      <button onclick="changeTextColor()" title="Text Colour">ğŸ’¬Colour</button>
      <button onclick="cycleFont()" title="Cycle Fonts">Font</button>
      <button onclick="clearUploadedImage()" title="Clear IMG">ğŸ—‘ï¸Image</button>
      <button onclick="testImageUpload()" title="AI">ğŸ§ªTest</button>
      <button onclick="testEffects()" title="Test Effects">ğŸ­ Effects</button>
      <button onclick="deleteIdea()" title="Delete Bubble">DeleteğŸ’­ï¸</button>
      <button onclick="closePanel()" title="Close">CloseğŸ’­ï¸</button>
    </div>
  </div>

  <!-- Scripts -->
  <script src="themes.js"></script>
  <script src="main.js"></script>
  <script src="media.js"></script>
  <script src="video.js"></script>
  <script>
    // Global scope exports - ensure all functions are available immediately
    console.log("ğŸ”§ Setting up global function exports...");
    
    try {
      // Export all functions to global scope
      window.loadYouTubeVideo = loadYouTubeVideo;
      window.toggleMusicPanel = toggleMusicPanel;
      window.loadMusicList = loadMusicList;
      window.playMusic = playMusic;
      window.stopMusic = stopMusic;
      window.toggleMediaToolbar = toggleMediaToolbar;
      window.handleBackgroundUpload = handleBackgroundUpload;
      window.handleVideoUpload = handleVideoUpload;
      window.captureCanvas = captureCanvas;
      window.captureCanvasOnly = captureCanvasOnly;
      window.rollDice = rollDice;
      window.showDiceSlider = showDiceSlider;
      window.hideDiceSlider = hideDiceSlider;
      window.uploadPlaylist = uploadPlaylist;
      window.cyclePlaylists = cyclePlaylists;
      window.loadUploadedPlaylist = loadUploadedPlaylist;
      window.loadVideoPlaylist = loadVideoPlaylist;
      window.videoPlayVideo = videoPlayVideo;
      window.videoPlay = videoPlay;
      window.videoPause = videoPause;
      window.videoTogglePlay = videoTogglePlay;
      window.videoNext = videoNext;
      window.videoPrev = videoPrev;
      window.videoTogglePlaylist = videoTogglePlaylist;
      window.videoToggleFullscreen = videoToggleFullscreen;
      window.videoClose = videoClose;
      window.showVideoControls = showVideoControls;
      window.showVideoPlaylist = showVideoPlaylist;
      window.updateVideoPlaylistDisplay = updateVideoPlaylistDisplay;
      window.toggleVideoPlayer = toggleVideoPlayer;
      window.initVideoPlayer = initVideoPlayer;
      
      // Recording functions
      window.recordState = recordState;
      window.startPlayback = startPlayback;
      
      // Main.js functions
      window.init = init;
      window.setupEventListeners = setupEventListeners;
      window.switchTheme = switchTheme;
      window.addIdea = addIdea;
      window.saveIdeas = saveIdeas;
      window.deleteAllIdeas = deleteAllIdeas;
      window.cycleBackground = cycleBackground;
      window.rotateBackground = rotateBackground;
      window.showPanel = showPanel;
      window.savePanel = savePanel;
      window.deleteIdea = deleteIdea;
      window.closePanel = closePanel;
      window.toggleGlow = toggleGlow;
      window.toggleFlash = toggleFlash;
      window.toggleAnimateColors = toggleAnimateColors;
      window.toggleTransparent = toggleTransparent;
      window.changeGlowColor = changeGlowColor;
      window.toggleFixed = toggleFixed;
      window.toggleStatic = toggleStatic;
      window.changeColor = changeColor;
      window.changeTextColor = changeTextColor;
      window.cycleFont = cycleFont;
      window.handleImageUpload = handleImageUpload;
      window.handleImageSelect = handleImageSelect;
      window.clearUploadedImage = clearUploadedImage;
      window.loadBackgroundImage = loadBackgroundImage;
      window.updatePresetSelector = updatePresetSelector;
      window.switchPreset = switchPreset;
      window.testImageUpload = testImageUpload;
      window.testEffects = testEffects;
      window.togglePanelSide = togglePanelSide;
      window.toggleSpeed = toggleSpeed;
      window.togglePauseButton = togglePauseButton;
      window.toggleCheckeredBorder = toggleCheckeredBorder;
      window.minimizePanel = minimizePanel;
      window.restorePanel = restorePanel;
      
      // Video.js functions
      window.videoPlayVideo = videoPlayVideo;
      window.extractYouTubeId = extractYouTubeId;
      window.fetchVideoTitle = fetchVideoTitle;
      window.videoTogglePlaylist = videoTogglePlaylist;
      window.videoToggleFullscreen = videoToggleFullscreen;
      window.showVideoControls = showVideoControls;
      window.showVideoPlaylist = showVideoPlaylist;
      window.forceCloseVideo = forceCloseVideo;
      window.updateVideoOpacity = updateVideoOpacity;
      window.updateVideoSize = updateVideoSize;
      window.loadVideoControlImages = loadVideoControlImages;
      window.setupMediaEventListeners = setupMediaEventListeners;
      window.closePlaylist = closePlaylist;
      window.minimizePlaylist = minimizePlaylist;
      window.debugVideoControls = debugVideoControls;
      window.testPngAccess = testPngAccess;
      
      // Test function
      window.testFunction = function() {
        console.log('âœ… Test function is working!');
        return 'test';
      };
      
      // Test if functions are available
      console.log("ğŸ”§ Testing function availability:");
      console.log("  rollDice:", typeof window.rollDice);
      console.log("  toggleMusicPanel:", typeof window.toggleMusicPanel);
      console.log("  captureCanvasOnly:", typeof window.captureCanvasOnly);
      console.log("  toggleMediaToolbar:", typeof window.toggleMediaToolbar);
      console.log("  testFunction:", typeof window.testFunction);
      
    } catch (error) {
      console.error("âŒ Error setting up global functions:", error);
    }
    
    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
      console.log("ğŸš€ Starting MindsEye initialization...");
      
      // Initialize core functionality
      if (typeof init === 'function') {
        init();
      }
      
      // Set up event listeners
      if (typeof setupEventListeners === 'function') {
        setupEventListeners();
      }
      
      // Initialize video player
      if (typeof initVideoPlayer === 'function') {
        initVideoPlayer();
      }
      
      // Set up media event listeners
      if (typeof setupMediaEventListeners === 'function') {
        setupMediaEventListeners();
      }
      
      // Set up toolbar auto-hide
      let toolbar = document.getElementById('toolbar');
      let inactivityTimeout;
      
      function showToolbar() {
        toolbar.style.opacity = "1";
        clearTimeout(inactivityTimeout);
        inactivityTimeout = setTimeout(() => {
          toolbar.style.opacity = "0";
        }, 5000);
      }
      
      document.addEventListener("mousemove", showToolbar);
      showToolbar();
      
      console.log("âœ… MindsEye initialization complete");
    });
  </script>
</body>
</html> 